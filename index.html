<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ekman Transport Visualizer</title>
    
    <!-- ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ìë™ ì „í™˜ CSS -->
    <style>
        /* CSS ë³€ìˆ˜ë¡œ í…Œë§ˆ ì •ì˜ */
        :root {
            --bg-primary: #f0f0f0;
            --bg-secondary: white;
            --border-color: #d0d0d0;
            --text-primary: #000;
            --text-secondary: #333;
            --button-bg: linear-gradient(to bottom, #f0f0f0 0%, #e0e0e0 100%);
            --button-hover: linear-gradient(to bottom, #f5f5f5 0%, #e5e5e5 100%);
            --button-active: linear-gradient(to bottom, #e0e0e0 0%, #f0f0f0 100%);
            --input-bg: white;
            --slider-bg: #e0e0e0;
            --plot-bg: white;
            --chart-bg: white;
            --chart-grid: lightgray;
        }
        
        /* ë‹¤í¬ ëª¨ë“œ í…Œë§ˆ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #2b2b2b;
                --bg-secondary: #1e1e1e;
                --border-color: #404040;
                --text-primary: #ffffff;
                --text-secondary: #e0e0e0;
                --button-bg: linear-gradient(to bottom, #404040 0%, #303030 100%);
                --button-hover: linear-gradient(to bottom, #4a4a4a 0%, #3a3a3a 100%);
                --button-active: linear-gradient(to bottom, #303030 0%, #404040 100%);
                --input-bg: #2d2d2d;
                --slider-bg: #404040;
                --plot-bg: #1e1e1e;
                --chart-bg: #2b2b2b;
                --chart-grid: #404040;
            }
        }
        
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ (í…Œë§ˆ ë³€ìˆ˜ ì‚¬ìš©) */
        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            font-size: 9pt;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .main-window {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            display: flex;
            min-height: calc(100vh - 16px);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        /* ì™¼ìª½ ì œì–´ íŒ¨ë„ */
        .control-frame {
            width: 320px;
            background-color: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            padding: 10px;
            overflow-y: auto;
            overflow-x: hidden;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .labelframe {
            border: 2px groove var(--border-color);
            margin: 8px 0;
            padding: 8px;
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .labelframe-title {
            font-weight: bold;
            font-size: 9pt;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            padding: 0 4px;
            margin-left: 8px;
            position: relative;
            top: -16px;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tk-button {
            background: var(--button-bg);
            border: 1px outset var(--border-color);
            color: var(--text-primary);
            padding: 4px 8px;
            margin: 2px;
            font-size: 8pt;
            cursor: pointer;
            min-width: 60px;
            font-family: 'Segoe UI', Arial, sans-serif;
            transition: all 0.3s ease;
        }
        
        .tk-button:hover {
            background: var(--button-hover);
            border-color: var(--border-color);
        }
        
        .tk-button:active {
            border: 1px inset var(--border-color);
            background: var(--button-active);
        }
        
        /* ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .tk-label {
            font-size: 8pt;
            color: var(--text-primary);
            margin: 2px 0;
            background-color: var(--bg-primary);
            display: block;
            transition: color 0.3s ease, background-color 0.3s ease;
        }
        
        /* ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ */
        .tk-scale {
            width: 200px;
            height: 20px;
            margin: 4px 0;
            background: var(--slider-bg);
            border: 1px inset var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .tk-scale::-webkit-slider-thumb {
            width: 16px;
            height: 16px;
            background: var(--button-bg);
            border: 1px outset var(--border-color);
            cursor: pointer;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        
        /* ì½¤ë³´ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .tk-combobox {
            background-color: var(--input-bg);
            color: var(--text-primary);
            border: 1px inset var(--border-color);
            padding: 2px;
            font-size: 8pt;
            width: 150px;
            transition: all 0.3s ease;
        }
        
        /* ë¼ë””ì˜¤ ë²„íŠ¼ */
        .tk-radiobutton {
            font-size: 8pt;
            margin: 2px 0;
            background-color: var(--bg-primary);
            transition: background-color 0.3s ease;
        }
        
        /* ì˜¤ë¥¸ìª½ í”Œë¡¯ ì˜ì—­ */
        .plot-frame {
            flex: 1;
            background-color: var(--plot-bg);
            border: 2px groove var(--border-color);
            margin: 5px;
            padding: 5px;
            min-height: calc(100vh - 100px);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        /* ê²°ê³¼ í‘œì‹œ ì˜ì—­ */
        .results-grid {
            display: grid;
            grid-template-columns: auto auto;
            gap: 4px;
            font-size: 8pt;
        }
        
        .result-label {
            text-align: right;
            padding-right: 8px;
            font-weight: normal;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }
        
        .result-value {
            text-align: left;
            font-family: 'Courier New', monospace;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin: 4px 0;
        }
        
        /* ìŠ¬ë¼ì´ë” ì»¨í…Œì´ë„ˆ */
        .slider-container {
            margin: 8px 0;
        }
        
        .slider-value {
            font-family: 'Courier New', monospace;
            font-size: 8pt;
            margin-left: 8px;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }
        
        /* ì œëª© ë°” */
        .title-bar {
            background-color: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 8px;
            font-weight: bold;
            font-size: 10pt;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        /* ë‹¤í¬ ëª¨ë“œì—ì„œ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar {
                width: 12px;
            }
            
            ::-webkit-scrollbar-track {
                background: var(--bg-primary);
            }
            
            ::-webkit-scrollbar-thumb {
                background: var(--border-color);
                border-radius: 6px;
            }
            
            ::-webkit-scrollbar-thumb:hover {
                background: #555;
            }
        }
        
        /* ë‹¤í¬ ëª¨ë“œì—ì„œ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ ê°œì„  */
        @media (prefers-color-scheme: dark) {
            input[type="range"] {
                accent-color: #4a9eff;
            }
            
            option {
                background-color: var(--input-bg);
                color: var(--text-primary);
            }
        }
        
        /* í”Œë¡¯ ì˜ì—­ ìµœì í™” */
        #plot-area {
            width: 100% !important;
            height: 100% !important;
            min-height: calc(100vh - 120px);
        }
        
        /* Plotly ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìµœì í™” */
        .plot-container {
            width: 100% !important;
            height: 100% !important;
        }
        
        /* í–¥ìƒëœ ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            background: var(--button-bg);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            padding: 0;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .mobile-menu-toggle:hover {
            background: var(--button-hover);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .mobile-menu-toggle:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        /* í–„ë²„ê±° ì•„ì´ì½˜ ì• ë‹ˆë©”ì´ì…˜ */
        .hamburger {
            width: 24px;
            height: 18px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .hamburger span {
            display: block;
            height: 3px;
            background: var(--text-primary);
            border-radius: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }
        
        .hamburger span:nth-child(1) {
            width: 100%;
        }
        
        .hamburger span:nth-child(2) {
            width: 80%;
            align-self: center;
        }
        
        .hamburger span:nth-child(3) {
            width: 100%;
        }
        
        /* í™œì„± ìƒíƒœ - X ì•„ì´ì½˜ìœ¼ë¡œ ë³€í™˜ */
        .mobile-menu-toggle.active .hamburger span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
            width: 100%;
        }
        
        .mobile-menu-toggle.active .hamburger span:nth-child(2) {
            opacity: 0;
            transform: scale(0);
        }
        
        .mobile-menu-toggle.active .hamburger span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
            width: 100%;
        }
        
        /* í–¥ìƒëœ ì˜¤ë²„ë ˆì´ */
        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 999;
            touch-action: manipulation;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .mobile-menu-overlay.active {
            opacity: 1;
        }
        
        /* ë©”ë‰´ íŒ¨ë„ ê°œì„  (ëª¨ë°”ì¼ì—ì„œë§Œ ì ìš©) */
        @media screen and (max-width: 767px) {
            .mobile-menu-panel {
                position: fixed;
                top: 0;
                left: -100%;
                width: 85%;
                max-width: 350px;
                height: 100vh;
                background: var(--bg-primary);
                z-index: 1001;
                padding: 80px 20px 20px 20px;
                overflow-x: auto;
                transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                border-right: 3px solid var(--border-color);
                box-shadow: 5px 0 25px rgba(0,0,0,0.3);
            }
        }
        
            .mobile-menu-panel.active {
                left: 0;
            }
            
            /* ë©”ë‰´ í—¤ë” */
            .mobile-menu-header {
            position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 70px;
                background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
                border-bottom: 2px solid var(--border-color);
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0 20px;
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            
            .mobile-menu-title {
            font-size: 18px;
                font-weight: bold;
            color: var(--text-primary);
                margin: 0;
            }
            
            .mobile-menu-close {
                display: block;
                width: 40px;
                height: 40px;
                background: transparent;
                border: 2px solid var(--border-color);
                border-radius: 8px;
                cursor: pointer;
                position: relative;
                transition: all 0.3s ease;
            touch-action: manipulation;
        }
        
        .mobile-menu-close:hover {
            background: var(--button-hover);
                transform: rotate(90deg);
        }
        
        .mobile-menu-close:active {
                transform: rotate(90deg) scale(0.9);
            }
            
            .mobile-menu-close::before,
            .mobile-menu-close::after {
                content: '';
                position: absolute;
                top: 50%;
                left: 50%;
                width: 20px;
                height: 2px;
                background: var(--text-primary);
                border-radius: 1px;
                transition: all 0.3s ease;
            }
            
            .mobile-menu-close::before {
                transform: translate(-50%, -50%) rotate(45deg);
            }
            
            .mobile-menu-close::after {
                transform: translate(-50%, -50%) rotate(-45deg);
            }
            
            /* ë©”ë‰´ ì•„ì´í…œ ì• ë‹ˆë©”ì´ì…˜ */
            .mobile-menu-item {
                opacity: 0;
                transform: translateX(-30px);
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .mobile-menu-panel.active .mobile-menu-item {
                opacity: 1;
                transform: translateX(0);
        }
        
            /* ìŠ¤íƒœê±°ë“œ ì• ë‹ˆë©”ì´ì…˜ ì§€ì—° */
            .mobile-menu-panel.active .mobile-menu-item:nth-child(1) { transition-delay: 0.1s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(2) { transition-delay: 0.15s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(3) { transition-delay: 0.2s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(4) { transition-delay: 0.25s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(5) { transition-delay: 0.3s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(6) { transition-delay: 0.35s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(7) { transition-delay: 0.4s; }
        
        /* ìŠ¤ì™€ì´í”„ ì§„í–‰ë¥  í‘œì‹œ */
        .swipe-indicator {
            position: absolute;
            top: 50%;
            right: -3px;
            width: 3px;
            height: 60px;
            background: linear-gradient(to bottom, transparent, #4A9EFF, transparent);
            border-radius: 2px;
            transform: translateY(-50%) scaleY(0);
            transition: transform 0.2s ease;
            z-index: 1002;
        }
        
        .swipe-indicator.active {
            transform: translateY(-50%) scaleY(1);
        }
        
        /* ë©”ë‰´ ê·¸ë¦¼ì íš¨ê³¼ */
        .mobile-menu-panel::before {
            content: '';
            position: absolute;
            top: 0;
            right: -10px;
            width: 10px;
            height: 100%;
            background: linear-gradient(to right, rgba(0,0,0,0.1), transparent);
            pointer-events: none;
        }
        
        /* ë°”ë”” ìŠ¤í¬ë¡¤ ë½ */
        body.menu-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        
        /* í„°ì¹˜ í”¼ë“œë°± í–¥ìƒ */
        .touch-feedback {
            position: relative;
            overflow: hidden;
        }
        
        .touch-feedback::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
            pointer-events: none;
        }
        
        .touch-feedback:active::after {
            width: 200px;
            height: 200px;
        }
        
        /* íƒœë¸”ë¦¿ ìŠ¤íƒ€ì¼ (768px - 1024px) */
        @media screen and (max-width: 1024px) and (min-width: 768px) {
            .control-frame {
                width: 280px;
                font-size: 8pt;
            }
            
            .tk-button {
                font-size: 7pt;
                padding: 3px 6px;
                min-width: 50px;
            }
            
            .tk-scale {
                width: 160px;
                height: 18px;
            }
            
            .labelframe-title {
                font-size: 8pt;
            }
            
            .tk-label {
                font-size: 7pt;
            }
            
            .slider-value {
                font-size: 7pt;
            }
            
            .results-grid {
                font-size: 7pt;
            }
            
            #plot-area {
                min-height: calc(100vh - 100px);
            }
        }
        
        /* ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ (< 768px) */
        @media screen and (max-width: 767px) {
            body {
                padding: 0;
                font-size: 8pt;
            }
            
            .title-bar {
                padding: 6px;
                font-size: 9pt;
                text-align: center;
            }
            
            .main-window {
                flex-direction: column;
                min-height: calc(100vh - 40px);
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
            
            .mobile-menu-close {
                display: block;
            }
            
            .mobile-menu-header {
                display: flex;
            }
            
            .mobile-menu-panel {
                width: 85%;
                max-width: 350px;
                position: fixed;
                top: 0;
                left: -100%;
                height: 100vh;
                background: var(--bg-primary);
                z-index: 1001;
                padding: 80px 20px 20px 20px;
                overflow-x: auto;
                transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                border-right: 3px solid var(--border-color);
                box-shadow: 5px 0 25px rgba(0,0,0,0.3);
            }
            
            .mobile-menu-panel.active {
                left: 0;
            }
            
            .mobile-menu-overlay.active {
                display: block;
            }
            
            .plot-frame {
                width: 100%;
                margin: 5px;
                padding: 5px;
                min-height: calc(100vh - 60px);
            }
            
            /* ëª¨ë°”ì¼ ìµœì í™” ì»¨íŠ¸ë¡¤ */
            .labelframe {
                margin: 6px 0;
                padding: 6px;
                border: 1px solid var(--border-color);
            }
            
            .labelframe-title {
                font-size: 9pt;
                font-weight: bold;
            }
            
            .tk-button {
                font-size: 9pt;
                padding: 8px 12px;
                min-width: 70px;
                margin: 3px;
                touch-action: manipulation;
            }
            
            .tk-scale {
                width: 100%;
                height: 25px;
                margin: 6px 0;
                touch-action: manipulation;
            }
            
            .tk-scale::-webkit-slider-thumb {
                width: 20px;
                height: 20px;
            }
            
            .tk-combobox {
                width: 100%;
                font-size: 9pt;
                padding: 8px;
                touch-action: manipulation;
            }
            
            .tk-label {
                font-size: 9pt;
                margin: 4px 0;
            }
            
            .slider-value {
                font-size: 9pt;
                font-weight: bold;
            }
            
            .button-group {
                flex-wrap: wrap;
                gap: 6px;
                justify-content: center;
            }
            
            .results-grid {
                font-size: 8pt;
                gap: 6px;
            }
            
            .result-label {
                font-weight: bold;
            }
            
            .result-value {
                font-size: 9pt;
            }
            
            /* ëª¨ë°”ì¼ ê·¸ë˜í”„ ìµœì í™” */
            #plot-area {
                min-height: calc(100vh - 80px);
                width: 100%;
            }
        }
        
        /* ì´ˆì†Œí˜• ëª¨ë°”ì¼ (< 480px) */
        @media screen and (max-width: 479px) {
            
            .control-frame {
                padding: 50px 10px 10px 10px;
            }
            
            .tk-button {
                font-size: 8pt;
                padding: 6px 10px;
                min-width: 60px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .button-group .tk-button {
                width: 100%;
                margin: 2px 0;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .result-label {
                text-align: center;
                padding-right: 0;
                margin-bottom: 2px;
            }
            
            .result-value {
                text-align: center;
                margin-bottom: 8px;
                font-weight: bold;
            }
        }
        
        /* ê°€ë¡œ ëª¨ë“œ ëª¨ë°”ì¼ ìµœì í™” */
        @media screen and (max-width: 767px) and (orientation: landscape) {
            .main-window {
                flex-direction: row;
            }
            
            .mobile-menu-panel {
                width: 320px;
                max-width: 320px;
                height: 100vh;
                position: fixed;
                top: 0;
                left: -320px;
                padding: 70px 15px 15px 15px;
            }
            
            .mobile-menu-panel.active {
                left: 0;
            }
            
            .plot-frame {
                min-height: calc(100vh - 20px);
                margin-left: 10px;
            }
            
            /* ê°€ë¡œ ëª¨ë“œì—ì„œ ë©”ë‰´ í—¤ë” ë†’ì´ ì¡°ì • */
            .mobile-menu-header {
                height: 60px;
            }
            
            .mobile-menu-title {
                font-size: 16px;
            }
        }
        
        /* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” */
        @media (hover: none) and (pointer: coarse) {
            .tk-button:hover {
                background: var(--button-bg);
            }
            
            .tk-button:active {
                background: var(--button-active);
                transform: scale(0.98);
            }
            
            .tk-scale::-webkit-slider-thumb {
                cursor: grab;
            }
            
            .tk-scale::-webkit-slider-thumb:active {
                cursor: grabbing;
                transform: scale(1.2);
            }
        }
        
        /* í…Œë§ˆ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        /* ë°ìŠ¤í¬í†±ì—ì„œ ëª¨ë°”ì¼ ê´€ë ¨ ìš”ì†Œ ìˆ¨ê¸°ê¸° */
        @media screen and (min-width: 768px) {
            .mobile-menu-header {
                display: none !important;
            }
            
            .mobile-menu-close {
                display: none !important;
            }
            
            .swipe-indicator {
                display: none !important;
            }
            
            .mobile-menu-item {
                opacity: 1 !important;
                transform: none !important;
                transition: none !important;
            }
        }
        
        /* ìŠ¤íƒœê±°ë“œ ì• ë‹ˆë©”ì´ì…˜ ì§€ì—° (ëª¨ë°”ì¼ì—ì„œë§Œ) */
        @media screen and (max-width: 767px) {
            .mobile-menu-panel.active .mobile-menu-item:nth-child(1) { transition-delay: 0.1s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(2) { transition-delay: 0.15s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(3) { transition-delay: 0.2s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(4) { transition-delay: 0.25s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(5) { transition-delay: 0.3s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(6) { transition-delay: 0.35s; }
            .mobile-menu-panel.active .mobile-menu-item:nth-child(7) { transition-delay: 0.4s; }
        }
    </style>
</head>
<body>
    <div class="title-bar">Ekman Transport Visualizer</div>
    
    <!-- í–¥ìƒëœ ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded="false">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>
    <div class="mobile-menu-overlay" onclick="closeMobileMenu()" ontouchend="closeMobileMenu()"></div>
    
    <div class="main-window">
        <!-- ì™¼ìª½ ì œì–´ íŒ¨ë„ (Tkinter GUIì™€ ë™ì¼í•œ ë ˆì´ì•„ì›ƒ) -->
        <div class="control-frame mobile-menu-panel">
            <!-- í–¥ìƒëœ ë©”ë‰´ í—¤ë” -->
            <div class="mobile-menu-header">
                <h2 class="mobile-menu-title">âš™ï¸ ì œì–´íŒ</h2>
                <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="ë©”ë‰´ ë‹«ê¸°"></button>
            </div>
            
            <!-- ìŠ¤ì™€ì´í”„ ì§„í–‰ë¥  í‘œì‹œ -->
            <div class="swipe-indicator"></div>
            
            <!-- ì–¸ì–´ ì„ íƒ -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">ğŸŒ ì–¸ì–´ ì„ íƒ</div>
                <label for="language" class="tk-label">Language:</label>
                <select id="language" class="tk-combobox">
                    <option value="en">English</option>
                    <option value="ko">í•œêµ­ì–´</option>
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="ja">æ—¥æœ¬èª</option>
                    <option value="es">EspaÃ±ol</option>
                    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                </select>
            </div>
            
            <!-- íŒŒë¼ë¯¸í„° ì„¤ì • -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">ğŸ›ï¸ íŒŒë¼ë¯¸í„° ì„¤ì •</div>
                
                <!-- ë°”ëŒ ì†ë„ -->
                <div class="slider-container">
                    <label for="wind_speed" class="tk-label">ğŸŒ¬ï¸ ë°”ëŒ ì†ë„ (m/s):</label>
                    <input type="range" id="wind_speed" class="tk-scale" min="0" max="30" value="10" step="0.1">
                    <span class="slider-value" id="wind_speed_value">10.0</span>
                </div>
                
                <!-- ë°”ëŒ ë°©í–¥ -->
                <div class="slider-container">
                    <label for="wind_direction" class="tk-label">ğŸ§­ ë°”ëŒ ë°©í–¥ (Â°):</label>
                    <input type="range" id="wind_direction" class="tk-scale" min="0" max="360" value="0" step="1">
                    <span class="slider-value" id="wind_direction_value">0</span>
                </div>
                
                <!-- ìœ„ë„ -->
                <div class="slider-container">
                    <label for="latitude" class="tk-label">ğŸŒ ìœ„ë„ (Â°):</label>
                    <input type="range" id="latitude" class="tk-scale" min="-90" max="90" value="30" step="1">
                    <span class="slider-value" id="latitude_value">30</span>
                </div>
                
                <!-- ê¹Šì´ -->
                <div class="slider-container">
                    <label for="depth" class="tk-label">ğŸŒŠ ê¹Šì´ (m):</label>
                    <input type="range" id="depth" class="tk-scale" min="10" max="500" value="100" step="10">
                    <span class="slider-value" id="depth_value">100</span>
                </div>
            </div>
            
            <!-- ì‹œê°í™” íƒ€ì… -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">ğŸ“Š ì‹œê°í™” íƒ€ì…</div>
                <div>
                    <input type="radio" id="vis_3d" name="vis_type" value="3d" checked class="tk-radiobutton">
                    <label for="vis_3d" class="tk-label" style="display: inline;">ğŸ”® 3D</label>
                </div>
                <div>
                    <input type="radio" id="vis_2d" name="vis_type" value="2d" class="tk-radiobutton">
                    <label for="vis_2d" class="tk-label" style="display: inline;">ğŸ“ˆ 2D</label>
                </div>
            </div>
            
            <!-- ì‚¬ì „ ì„¤ì • -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">âš¡ ì‚¬ì „ ì„¤ì •</div>
                <div class="button-group">
                    <button class="tk-button touch-feedback" onclick="setPreset('normal')">ğŸŒ¤ï¸ ì¼ë°˜</button>
                    <button class="tk-button touch-feedback" onclick="setPreset('strong')">ğŸ’¨ ê°•í’</button>
                    <button class="tk-button touch-feedback" onclick="setPreset('typhoon')">ğŸŒªï¸ íƒœí’</button>
                </div>
            </div>
            
            <!-- ì§€ì—­ ì„ íƒ -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">ğŸ—ºï¸ ì§€ì—­ ì„ íƒ</div>
                <select id="location" class="tk-combobox" aria-label="ì§€ì—­ ì„ íƒ">
                    <option value="custom">ğŸ¯ ì‚¬ìš©ì ì„¤ì •</option>
                    <option value="los_angeles">ğŸ‡ºğŸ‡¸ ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤</option>
                    <option value="busan">ğŸ‡°ğŸ‡· ë¶€ì‚°</option>
                    <option value="north_pacific">ğŸŒŠ ë¶íƒœí‰ì–‘</option>
                    <option value="north_atlantic">ğŸŒŠ ë¶ëŒ€ì„œì–‘</option>
                    <option value="southern_ocean">ğŸ§Š ë‚¨ê·¹í•´</option>
                    <option value="equator">ğŸ”† ì ë„</option>
                </select>
            </div>
            
            <!-- ê³„ì‚° ë²„íŠ¼ -->
            <div class="button-group mobile-menu-item" style="margin: 16px 0;">
                <button id="calculate-btn" class="tk-button touch-feedback" style="width: 140px; height: 30px; font-weight: bold;" onclick="calculateAndVisualize()">ğŸ”„ ê³„ì‚° ë° ì‹œê°í™”</button>
                <button id="export-btn" class="tk-button touch-feedback" style="width: 100px; height: 30px;" onclick="exportResults()">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
            </div>
            
            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div class="labelframe mobile-menu-item">
                <div class="labelframe-title">ğŸ“‹ ê³„ì‚° ê²°ê³¼</div>
                <div class="results-grid">
                    <div class="result-label">ğŸ’¨ ë°”ëŒ ì‘ë ¥:</div>
                    <div class="result-value" id="wind_stress">-</div>
                    
                    <div class="result-label">ğŸ“ ì—í¬ë§Œ ê¹Šì´:</div>
                    <div class="result-value" id="ekman_depth">-</div>
                    
                    <div class="result-label">ğŸŒŠ ì´ ìˆ˜ì†¡ëŸ‰:</div>
                    <div class="result-value" id="total_transport">-</div>
                    
                    <div class="result-label">âš¡ ì—ë„ˆì§€ ì „ë‹¬ë¥ :</div>
                    <div class="result-value" id="energy_transfer">-</div>
                </div>
            </div>
            
        </div>
        
        <!-- ì˜¤ë¥¸ìª½ í”Œë¡¯ ì˜ì—­ -->
        <div class="plot-frame">
            <div id="plot-area" style="width: 100%; height: 100%;">
                <div style="text-align: center; padding: 50px; color: #666;">
                    <p>ê³„ì‚° ë° ì‹œê°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- ì—í¬ë§Œ ìˆ˜ì†¡ ê³„ì‚° ë° ì‹œê°í™” JavaScript -->
    <script>
        // ğŸŒ ë‹¤ì¤‘ì–¸ì–´ ì§€ì› ì‹œìŠ¤í…œ
        const translations = {
            'en': {
                // UI ìš”ì†Œë“¤
                'app_title': "Ekman Transport Visualizer",
                'language_select': "ğŸŒ Language Selection",
                'param_settings': "ğŸ›ï¸ Parameter Settings",
                'wind_speed': "ğŸŒ¬ï¸ Wind Speed (m/s)",
                'wind_direction': "ğŸ§­ Wind Direction (Â°)",
                'latitude': "ğŸŒ Latitude (Â°)",
                'depth': "ğŸŒŠ Depth (m)",
                'vis_type': "ğŸ“Š Visualization Type",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ Preset Settings",
                'preset_normal': "ğŸŒ¤ï¸ Normal",
                'preset_strong': "ğŸ’¨ Strong Wind",
                'preset_typhoon': "ğŸŒªï¸ Typhoon",
                'location_select': "ğŸ—ºï¸ Location Selection",
                'calc_button': "ğŸ”„ Calculate & Visualize",
                'export_button': "ğŸ’¾ Export",
                'results_title': "ğŸ“‹ Calculation Results",
                'wind_stress': "ğŸ’¨ Wind Stress:",
                'ekman_depth': "ğŸ“ Ekman Depth:",
                'total_transport': "ğŸŒŠ Total Transport:",
                'energy_transfer': "âš¡ Energy Transfer:",
                'calc_message': "Click Calculate & Visualize button",
                
                // ì§€ì—­ ì„ íƒ
                'loc_custom': "ğŸ¯ Custom Settings",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ Los Angeles",
                'loc_busan': "ğŸ‡°ğŸ‡· Busan",
                'loc_north_pacific': "ğŸŒŠ North Pacific",
                'loc_north_atlantic': "ğŸŒŠ North Atlantic", 
                'loc_southern_ocean': "ğŸ§Š Southern Ocean",
                'loc_equator': "ğŸ”† Equator",
                
                // ì°¨íŠ¸ ì œëª©
                'chart_title_3d': "ğŸŒŠ 3D Ekman Transport Visualization",
                'chart_title_2d': "ğŸŒŠ Ekman Transport Visualization",
                'chart_title_mobile': "ğŸŒŠ Ekman Transport Visualization"
            },
            'ko': {
                // UI ìš”ì†Œë“¤
                'app_title': "ì—í¬ë§Œ ìˆ˜ì†¡ ì‹œê°í™”",
                'language_select': "ğŸŒ ì–¸ì–´ ì„ íƒ",
                'param_settings': "ğŸ›ï¸ íŒŒë¼ë¯¸í„° ì„¤ì •",
                'wind_speed': "ğŸŒ¬ï¸ ë°”ëŒ ì†ë„ (m/s)",
                'wind_direction': "ğŸ§­ ë°”ëŒ ë°©í–¥ (Â°)",
                'latitude': "ğŸŒ ìœ„ë„ (Â°)",
                'depth': "ğŸŒŠ ê¹Šì´ (m)",
                'vis_type': "ğŸ“Š ì‹œê°í™” íƒ€ì…",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ ì‚¬ì „ ì„¤ì •",
                'preset_normal': "ğŸŒ¤ï¸ ì¼ë°˜",
                'preset_strong': "ğŸ’¨ ê°•í’",
                'preset_typhoon': "ğŸŒªï¸ íƒœí’",
                'location_select': "ğŸ—ºï¸ ì§€ì—­ ì„ íƒ",
                'calc_button': "ğŸ”„ ê³„ì‚° ë° ì‹œê°í™”",
                'export_button': "ğŸ’¾ ë‚´ë³´ë‚´ê¸°",
                'results_title': "ğŸ“‹ ê³„ì‚° ê²°ê³¼",
                'wind_stress': "ğŸ’¨ ë°”ëŒ ì‘ë ¥:",
                'ekman_depth': "ğŸ“ ì—í¬ë§Œ ê¹Šì´:",
                'total_transport': "ğŸŒŠ ì´ ìˆ˜ì†¡ëŸ‰:",
                'energy_transfer': "âš¡ ì—ë„ˆì§€ ì „ë‹¬ë¥ :",
                'calc_message': "ê³„ì‚° ë° ì‹œê°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”",
                
                // ì§€ì—­ ì„ íƒ
                'loc_custom': "ğŸ¯ ì‚¬ìš©ì ì„¤ì •",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤",
                'loc_busan': "ğŸ‡°ğŸ‡· ë¶€ì‚°",
                'loc_north_pacific': "ğŸŒŠ ë¶íƒœí‰ì–‘",
                'loc_north_atlantic': "ğŸŒŠ ë¶ëŒ€ì„œì–‘",
                'loc_southern_ocean': "ğŸ§Š ë‚¨ê·¹í•´",
                'loc_equator': "ğŸ”† ì ë„",
                
                // ì°¨íŠ¸ ì œëª©
                'chart_title_3d': "ğŸŒŠ 3D ì—í¬ë§Œ ìˆ˜ì†¡ ì‹œê°í™”",
                'chart_title_2d': "ğŸŒŠ ì—í¬ë§Œ ìˆ˜ì†¡ ì‹œê°í™”",
                'chart_title_mobile': "ğŸŒŠ ì—í¬ë§Œ ìˆ˜ì†¡ ì‹œê°í™”"
            },
            'zh': {
                // UI ìš”ì†Œë“¤
                'app_title': "åŸƒå…‹æ›¼è¾“è¿å¯è§†åŒ–",
                'language_select': "ğŸŒ è¯­è¨€é€‰æ‹©",
                'param_settings': "ğŸ›ï¸ å‚æ•°è®¾ç½®",
                'wind_speed': "ğŸŒ¬ï¸ é£é€Ÿ (m/s)",
                'wind_direction': "ğŸ§­ é£å‘ (Â°)",
                'latitude': "ğŸŒ çº¬åº¦ (Â°)",
                'depth': "ğŸŒŠ æ·±åº¦ (m)",
                'vis_type': "ğŸ“Š å¯è§†åŒ–ç±»å‹",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ é¢„è®¾è®¾ç½®",
                'preset_normal': "ğŸŒ¤ï¸ æ­£å¸¸",
                'preset_strong': "ğŸ’¨ å¼ºé£",
                'preset_typhoon': "ğŸŒªï¸ å°é£",
                'location_select': "ğŸ—ºï¸ ä½ç½®é€‰æ‹©",
                'calc_button': "ğŸ”„ è®¡ç®—ä¸å¯è§†åŒ–",
                'export_button': "ğŸ’¾ å¯¼å‡º",
                'results_title': "ğŸ“‹ è®¡ç®—ç»“æœ",
                'wind_stress': "ğŸ’¨ é£åº”åŠ›:",
                'ekman_depth': "ğŸ“ åŸƒå…‹æ›¼æ·±åº¦:",
                'total_transport': "ğŸŒŠ æ€»è¾“è¿é‡:",
                'energy_transfer': "âš¡ èƒ½é‡ä¼ è¾“ç‡:",
                'calc_message': "ç‚¹å‡»è®¡ç®—ä¸å¯è§†åŒ–æŒ‰é’®",
                
                // åœ°åŒºé€‰æ‹©
                'loc_custom': "ğŸ¯ è‡ªå®šä¹‰è®¾ç½®",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ æ´›æ‰çŸ¶",
                'loc_busan': "ğŸ‡°ğŸ‡· é‡œå±±",
                'loc_north_pacific': "ğŸŒŠ åŒ—å¤ªå¹³æ´‹",
                'loc_north_atlantic': "ğŸŒŠ åŒ—å¤§è¥¿æ´‹",
                'loc_southern_ocean': "ğŸ§Š å—ææµ·",
                'loc_equator': "ğŸ”† èµ¤é“",
                
                // å›¾è¡¨æ ‡é¢˜
                'chart_title_3d': "ğŸŒŠ 3D åŸƒå…‹æ›¼è¾“è¿å¯è§†åŒ–",
                'chart_title_2d': "ğŸŒŠ åŸƒå…‹æ›¼è¾“è¿å¯è§†åŒ–",
                'chart_title_mobile': "ğŸŒŠ åŸƒå…‹æ›¼è¾“è¿å¯è§†åŒ–"
            },
            'ja': {
                // UI ìš”ì†Œë“¤
                'app_title': "ã‚¨ã‚¯ãƒãƒ³è¼¸é€å¯è¦–åŒ–",
                'language_select': "ğŸŒ è¨€èªé¸æŠ",
                'param_settings': "ğŸ›ï¸ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š",
                'wind_speed': "ğŸŒ¬ï¸ é¢¨é€Ÿ (m/s)",
                'wind_direction': "ğŸ§­ é¢¨å‘ (Â°)",
                'latitude': "ğŸŒ ç·¯åº¦ (Â°)",
                'depth': "ğŸŒŠ æ·±åº¦ (m)",
                'vis_type': "ğŸ“Š å¯è¦–åŒ–ã‚¿ã‚¤ãƒ—",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®š",
                'preset_normal': "ğŸŒ¤ï¸ é€šå¸¸",
                'preset_strong': "ğŸ’¨ å¼·é¢¨",
                'preset_typhoon': "ğŸŒªï¸ å°é¢¨",
                'location_select': "ğŸ—ºï¸ å ´æ‰€é¸æŠ",
                'calc_button': "ğŸ”„ è¨ˆç®—ã¨å¯è¦–åŒ–",
                'export_button': "ğŸ’¾ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ",
                'results_title': "ğŸ“‹ è¨ˆç®—çµæœ",
                'wind_stress': "ğŸ’¨ é¢¨å¿œåŠ›:",
                'ekman_depth': "ğŸ“ ã‚¨ã‚¯ãƒãƒ³æ·±åº¦:",
                'total_transport': "ğŸŒŠ ç·è¼¸é€é‡:",
                'energy_transfer': "âš¡ ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¼é”ç‡:",
                'calc_message': "è¨ˆç®—ã¨å¯è¦–åŒ–ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„",
                
                // åœ°åŸŸé¸æŠ
                'loc_custom': "ğŸ¯ ã‚«ã‚¹ã‚¿ãƒ è¨­å®š",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ ãƒ­ã‚µãƒ³ã‚¼ãƒ«ã‚¹",
                'loc_busan': "ğŸ‡°ğŸ‡· é‡œå±±",
                'loc_north_pacific': "ğŸŒŠ åŒ—å¤ªå¹³æ´‹",
                'loc_north_atlantic': "ğŸŒŠ åŒ—å¤§è¥¿æ´‹",
                'loc_southern_ocean': "ğŸ§Š å—æ¥µæµ·",
                'loc_equator': "ğŸ”† èµ¤é“",
                
                // ãƒãƒ£ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«
                'chart_title_3d': "ğŸŒŠ 3D ã‚¨ã‚¯ãƒãƒ³è¼¸é€å¯è¦–åŒ–",
                'chart_title_2d': "ğŸŒŠ ã‚¨ã‚¯ãƒãƒ³è¼¸é€å¯è¦–åŒ–",
                'chart_title_mobile': "ğŸŒŠ ã‚¨ã‚¯ãƒãƒ³è¼¸é€å¯è¦–åŒ–"
            },
            'es': {
                // UI ìš”ì†Œë“¤
                'app_title': "Visualizador de Transporte de Ekman",
                'language_select': "ğŸŒ SelecciÃ³n de Idioma",
                'param_settings': "ğŸ›ï¸ ConfiguraciÃ³n de ParÃ¡metros",
                'wind_speed': "ğŸŒ¬ï¸ Velocidad del Viento (m/s)",
                'wind_direction': "ğŸ§­ DirecciÃ³n del Viento (Â°)",
                'latitude': "ğŸŒ Latitud (Â°)",
                'depth': "ğŸŒŠ Profundidad (m)",
                'vis_type': "ğŸ“Š Tipo de VisualizaciÃ³n",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ ConfiguraciÃ³n Predefinida",
                'preset_normal': "ğŸŒ¤ï¸ Normal",
                'preset_strong': "ğŸ’¨ Viento Fuerte",
                'preset_typhoon': "ğŸŒªï¸ TifÃ³n",
                'location_select': "ğŸ—ºï¸ SelecciÃ³n de UbicaciÃ³n",
                'calc_button': "ğŸ”„ Calcular y Visualizar",
                'export_button': "ğŸ’¾ Exportar",
                'results_title': "ğŸ“‹ Resultados del CÃ¡lculo",
                'wind_stress': "ğŸ’¨ Esfuerzo del Viento:",
                'ekman_depth': "ğŸ“ Profundidad de Ekman:",
                'total_transport': "ğŸŒŠ Transporte Total:",
                'energy_transfer': "âš¡ Transferencia de EnergÃ­a:",
                'calc_message': "Haga clic en Calcular y Visualizar",
                
                // SelecciÃ³n de regiÃ³n
                'loc_custom': "ğŸ¯ ConfiguraciÃ³n Personalizada",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ Los Ãngeles",
                'loc_busan': "ğŸ‡°ğŸ‡· Busan",
                'loc_north_pacific': "ğŸŒŠ PacÃ­fico Norte",
                'loc_north_atlantic': "ğŸŒŠ AtlÃ¡ntico Norte",
                'loc_southern_ocean': "ğŸ§Š OcÃ©ano Austral",
                'loc_equator': "ğŸ”† Ecuador",
                
                // TÃ­tulos de grÃ¡ficos
                'chart_title_3d': "ğŸŒŠ VisualizaciÃ³n 3D del Transporte de Ekman",
                'chart_title_2d': "ğŸŒŠ VisualizaciÃ³n del Transporte de Ekman",
                'chart_title_mobile': "ğŸŒŠ VisualizaciÃ³n del Transporte de Ekman"
            },
            'ru': {
                // UI ìš”ì†Œë“¤
                'app_title': "Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ­ĞºĞ¼Ğ°Ğ½Ğ°",
                'language_select': "ğŸŒ Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¯Ğ·Ñ‹ĞºĞ°",
                'param_settings': "ğŸ›ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²",
                'wind_speed': "ğŸŒ¬ï¸ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ’ĞµÑ‚Ñ€Ğ° (Ğ¼/Ñ)",
                'wind_direction': "ğŸ§­ ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ’ĞµÑ‚Ñ€Ğ° (Â°)",
                'latitude': "ğŸŒ Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ° (Â°)",
                'depth': "ğŸŒŠ Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ° (Ğ¼)",
                'vis_type': "ğŸ“Š Ğ¢Ğ¸Ğ¿ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸",
                'vis_3d': "ğŸ”® 3D",
                'vis_2d': "ğŸ“ˆ 2D",
                'preset_settings': "âš¡ ĞŸÑ€ĞµĞ´ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸",
                'preset_normal': "ğŸŒ¤ï¸ ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾",
                'preset_strong': "ğŸ’¨ Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ’ĞµÑ‚ĞµÑ€",
                'preset_typhoon': "ğŸŒªï¸ Ğ¢Ğ°Ğ¹Ñ„ÑƒĞ½",
                'location_select': "ğŸ—ºï¸ Ğ’Ñ‹Ğ±Ğ¾Ñ€ ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ",
                'calc_button': "ğŸ”„ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¸ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                'export_button': "ğŸ’¾ Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚",
                'results_title': "ğŸ“‹ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ Ğ°ÑÑ‡ĞµÑ‚Ğ°",
                'wind_stress': "ğŸ’¨ ĞĞ°Ğ¿Ñ€ÑĞ¶ĞµĞ½Ğ¸Ğµ Ğ’ĞµÑ‚Ñ€Ğ°:",
                'ekman_depth': "ğŸ“ Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ° Ğ­ĞºĞ¼Ğ°Ğ½Ğ°:",
                'total_transport': "ğŸŒŠ ĞĞ±Ñ‰Ğ¸Ğ¹ ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ:",
                'energy_transfer': "âš¡ ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ğ¸:",
                'calc_message': "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¸ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                
                // Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğ°
                'loc_custom': "ğŸ¯ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸",
                'loc_los_angeles': "ğŸ‡ºğŸ‡¸ Ğ›Ğ¾Ñ-ĞĞ½Ğ´Ğ¶ĞµĞ»ĞµÑ",
                'loc_busan': "ğŸ‡°ğŸ‡· ĞŸÑƒÑĞ°Ğ½",
                'loc_north_pacific': "ğŸŒŠ Ğ¡ĞµĞ²ĞµÑ€Ğ½Ğ°Ñ Ñ‡Ğ°ÑÑ‚ÑŒ Ğ¢Ğ¸Ñ…Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞµĞ°Ğ½Ğ°",
                'loc_north_atlantic': "ğŸŒŠ Ğ¡ĞµĞ²ĞµÑ€Ğ½Ğ°Ñ ĞÑ‚Ğ»Ğ°Ğ½Ñ‚Ğ¸ĞºĞ°",
                'loc_southern_ocean': "ğŸ§Š Ğ®Ğ¶Ğ½Ñ‹Ğ¹ Ğ¾ĞºĞµĞ°Ğ½",
                'loc_equator': "ğŸ”† Ğ­ĞºĞ²Ğ°Ñ‚Ğ¾Ñ€",
                
                // Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¸ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ²
                'chart_title_3d': "ğŸŒŠ 3D Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ­ĞºĞ¼Ğ°Ğ½Ğ°",
                'chart_title_2d': "ğŸŒŠ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ­ĞºĞ¼Ğ°Ğ½Ğ°",
                'chart_title_mobile': "ğŸŒŠ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞŸĞµÑ€ĞµĞ½Ğ¾ÑĞ° Ğ­ĞºĞ¼Ğ°Ğ½Ğ°"
            }
        };
        
        // í˜„ì¬ ì–¸ì–´ ì„¤ì • (ê¸°ë³¸ê°’: í•œêµ­ì–´)
        let currentLanguage = localStorage.getItem('ekman_language') || 'ko';
        
        // ë²ˆì—­ í•¨ìˆ˜
        function t(key) {
            return translations[currentLanguage][key] || translations['en'][key] || key;
        }
        
        // UI í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateUITexts() {
            // ì œëª© ë°”
            document.querySelector('.title-bar').textContent = t('app_title');
            
            // ëª¨ë°”ì¼ ë©”ë‰´ ì œëª© - ì–¸ì–´ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì„¤ì •
            const mobileTitle = currentLanguage === 'ko' ? 'âš™ï¸ ì œì–´íŒ' :
                               currentLanguage === 'zh' ? 'âš™ï¸ æ§åˆ¶é¢æ¿' :
                               currentLanguage === 'ja' ? 'âš™ï¸ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«' :
                               currentLanguage === 'es' ? 'âš™ï¸ Panel de Control' :
                               currentLanguage === 'ru' ? 'âš™ï¸ ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ' :
                               'âš™ï¸ Control Panel';
            document.querySelector('.mobile-menu-title').textContent = mobileTitle;
            
            // ë¼ë²¨í”„ë ˆì„ ì œëª©ë“¤ì„ ì§ì ‘ ì„ íƒí•˜ì—¬ ì—…ë°ì´íŠ¸
            const labelframeTitles = document.querySelectorAll('.labelframe-title');
            labelframeTitles.forEach((element) => {
                const currentText = element.textContent.trim();
                
                // ì–¸ì–´ ì„ íƒ
                if (currentText.includes('ì–¸ì–´') || currentText.includes('Language') || currentText.includes('è¯­è¨€') || 
                    currentText.includes('è¨€èª') || currentText.includes('Idioma') || currentText.includes('Ğ¯Ğ·Ñ‹Ğº')) {
                    element.textContent = t('language_select');
                }
                // íŒŒë¼ë¯¸í„° ì„¤ì •
                else if (currentText.includes('íŒŒë¼ë¯¸í„°') || currentText.includes('Parameter') || currentText.includes('å‚æ•°') || 
                         currentText.includes('ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿') || currentText.includes('ParÃ¡metros') || currentText.includes('ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€')) {
                    element.textContent = t('param_settings');
                }
                // ì‹œê°í™” íƒ€ì…
                else if (currentText.includes('ì‹œê°í™”') || currentText.includes('Visualization') || currentText.includes('å¯è§†åŒ–') || 
                         currentText.includes('å¯è¦–åŒ–') || currentText.includes('VisualizaciÃ³n') || currentText.includes('Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸')) {
                    element.textContent = t('vis_type');
                }
                // ì‚¬ì „ ì„¤ì •
                else if (currentText.includes('ì‚¬ì „') || currentText.includes('Preset') || currentText.includes('é¢„è®¾') || 
                         currentText.includes('ãƒ—ãƒªã‚»ãƒƒãƒˆ') || currentText.includes('Predefinida') || currentText.includes('ĞŸÑ€ĞµĞ´ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸')) {
                    element.textContent = t('preset_settings');
                }
                // ì§€ì—­/ìœ„ì¹˜ ì„ íƒ
                else if (currentText.includes('ì§€ì—­') || currentText.includes('Location') || currentText.includes('ä½ç½®') || 
                         currentText.includes('å ´æ‰€') || currentText.includes('UbicaciÃ³n') || currentText.includes('ĞœĞµÑÑ‚Ğ¾Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ')) {
                    element.textContent = t('location_select');
                }
                // ê³„ì‚° ê²°ê³¼
                else if (currentText.includes('ê²°ê³¼') || currentText.includes('Results') || currentText.includes('ç»“æœ') || 
                         currentText.includes('çµæœ') || currentText.includes('Resultados') || currentText.includes('Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹')) {
                    element.textContent = t('results_title');
                }
            });
            
            // ìŠ¬ë¼ì´ë” ë¼ë²¨ë“¤
            const windSpeedLabel = document.querySelector('label[for="wind_speed"]');
            if (windSpeedLabel) windSpeedLabel.textContent = t('wind_speed') + ':';
            
            const windDirectionLabel = document.querySelector('label[for="wind_direction"]');
            if (windDirectionLabel) windDirectionLabel.textContent = t('wind_direction') + ':';
            
            const latitudeLabel = document.querySelector('label[for="latitude"]');
            if (latitudeLabel) latitudeLabel.textContent = t('latitude') + ':';
            
            const depthLabel = document.querySelector('label[for="depth"]');
            if (depthLabel) depthLabel.textContent = t('depth') + ':';
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ë¼ë²¨ë“¤
            const vis3dLabel = document.querySelector('label[for="vis_3d"]');
            if (vis3dLabel) vis3dLabel.textContent = t('vis_3d');
            
            const vis2dLabel = document.querySelector('label[for="vis_2d"]');
            if (vis2dLabel) vis2dLabel.textContent = t('vis_2d');
            
            // ë²„íŠ¼ë“¤
            document.querySelectorAll('.tk-button').forEach(button => {
                const text = button.textContent.trim();
                if (text.includes('ì¼ë°˜') || text.includes('Normal') || text.includes('æ­£å¸¸') || text.includes('é€šå¸¸') || text.includes('ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾')) {
                    button.textContent = t('preset_normal');
                } else if (text.includes('ê°•í’') || text.includes('Strong Wind') || text.includes('å¼ºé£') || text.includes('å¼·é¢¨') || text.includes('Viento Fuerte') || text.includes('Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ’ĞµÑ‚ĞµÑ€')) {
                    button.textContent = t('preset_strong');
                } else if (text.includes('íƒœí’') || text.includes('Typhoon') || text.includes('å°é£') || text.includes('å°é¢¨') || text.includes('TifÃ³n') || text.includes('Ğ¢Ğ°Ğ¹Ñ„ÑƒĞ½')) {
                    button.textContent = t('preset_typhoon');
                } else if (text.includes('ê³„ì‚°') || text.includes('Calculate') || text.includes('è®¡ç®—') || text.includes('è¨ˆç®—') || text.includes('Calcular') || text.includes('Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ')) {
                    button.textContent = t('calc_button');
                } else if (text.includes('ë‚´ë³´ë‚´ê¸°') || text.includes('Export') || text.includes('å¯¼å‡º') || text.includes('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ') || text.includes('Exportar') || text.includes('Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚')) {
                    button.textContent = t('export_button');
                }
            });
            
            // ê²°ê³¼ ë¼ë²¨ë“¤ì„ ì§ì ‘ ì„ íƒí•˜ì—¬ ì—…ë°ì´íŠ¸
            const resultLabels = document.querySelectorAll('.result-label');
            resultLabels.forEach((element) => {
                const currentText = element.textContent.trim();
                
                // ë°”ëŒ ì‘ë ¥
                if (currentText.includes('ë°”ëŒ') || currentText.includes('Wind') || currentText.includes('é£') || 
                    currentText.includes('é¢¨') || currentText.includes('Viento') || currentText.includes('Ğ’ĞµÑ‚Ñ€Ğ°')) {
                    element.textContent = t('wind_stress');
                }
                // ì—í¬ë§Œ ê¹Šì´
                else if (currentText.includes('ì—í¬ë§Œ') || currentText.includes('Ekman') || currentText.includes('åŸƒå…‹æ›¼') || 
                         currentText.includes('ã‚¨ã‚¯ãƒãƒ³') || currentText.includes('Ğ­ĞºĞ¼Ğ°Ğ½Ğ°')) {
                    element.textContent = t('ekman_depth');
                }
                // ì´ ìˆ˜ì†¡ëŸ‰
                else if (currentText.includes('ìˆ˜ì†¡') || currentText.includes('Transport') || currentText.includes('è¾“è¿') || 
                         currentText.includes('è¼¸é€') || currentText.includes('Transporte') || currentText.includes('ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ')) {
                    element.textContent = t('total_transport');
                }
                // ì—ë„ˆì§€ ì „ë‹¬ë¥ 
                else if (currentText.includes('ì—ë„ˆì§€') || currentText.includes('Energy') || currentText.includes('èƒ½é‡') || 
                         currentText.includes('ã‚¨ãƒãƒ«ã‚®ãƒ¼') || currentText.includes('EnergÃ­a') || currentText.includes('Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ğ¸')) {
                    element.textContent = t('energy_transfer');
                }
            });
            
            // ì§€ì—­ ì„ íƒ ì˜µì…˜ë“¤
            const locationOptions = document.querySelectorAll('#location option');
            const locationKeys = ['loc_custom', 'loc_los_angeles', 'loc_busan', 'loc_north_pacific', 'loc_north_atlantic', 'loc_southern_ocean', 'loc_equator'];
            locationOptions.forEach((option, index) => {
                if (locationKeys[index]) {
                    option.textContent = t(locationKeys[index]);
                }
            });
            
            // í”Œë¡¯ ì˜ì—­ ê¸°ë³¸ ë©”ì‹œì§€
            const plotMessage = document.querySelector('#plot-area > div > p');
            if (plotMessage) {
                plotMessage.textContent = t('calc_message');
            }
            
            console.log(`ğŸŒ ì–¸ì–´ê°€ ${currentLanguage}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
        function changeLanguage(newLanguage) {
            currentLanguage = newLanguage;
            localStorage.setItem('ekman_language', newLanguage);
            updateUITexts();
            
            // ì°¨íŠ¸ê°€ ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆë‹¤ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            if (currentResults) {
                const visType = document.querySelector('input[name="vis_type"]:checked').value;
                let plotData;
                let config;
                
                if (isMobile()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = createMobile2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        scrollZoom: true,
                        doubleClick: 'reset',
                        touchAction: 'auto'
                    };
                } else if (isTablet()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                } else {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                }
                
                document.getElementById('plot-area').innerHTML = '';
                Plotly.newPlot('plot-area', plotData.data, plotData.layout, config);
            }
        }
        
        // ì „ì—­ ë³€ìˆ˜
        let currentResults = null;
        
        // ìœ„ì¹˜ ë°ì´í„°
        const LOCATIONS = {
            'los_angeles': {lat: 34.0, wind: 3.0, wind_dir: 270},
            'busan': {lat: 35.1, wind: 3.5, wind_dir: 135},
            'north_pacific': {lat: 45.0, wind: 6.0, wind_dir: 135},
            'north_atlantic': {lat: 50.0, wind: 8.0, wind_dir: 270},
            'southern_ocean': {lat: -60.0, wind: 11.0, wind_dir: 270},
            'equator': {lat: 2.0, wind: 2.0, wind_dir: 90}
        };
        
        // ë¬¼ë¦¬ ìƒìˆ˜
        const RHO_WATER = 1025;  // kg/mÂ³
        const RHO_AIR = 1.225;   // kg/mÂ³
        const CD = 0.0013;       // í•­ë ¥ ê³„ìˆ˜
        const OMEGA = 7.2921e-5; // ì§€êµ¬ ìì „ ê°ì†ë„ (rad/s)
        
        // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
        function updateSliderValues() {
            document.getElementById('wind_speed_value').textContent = parseFloat(document.getElementById('wind_speed').value).toFixed(1);
            document.getElementById('wind_direction_value').textContent = parseFloat(document.getElementById('wind_direction').value).toFixed(0);
            document.getElementById('latitude_value').textContent = parseFloat(document.getElementById('latitude').value).toFixed(0);
            document.getElementById('depth_value').textContent = parseFloat(document.getElementById('depth').value).toFixed(0);
        }
        
        // ì‚¬ì „ ì„¤ì •
        function setPreset(type) {
            if (type === 'normal') {
                document.getElementById('wind_speed').value = 10.0;
                document.getElementById('wind_direction').value = 0;
                document.getElementById('latitude').value = 30;
                document.getElementById('depth').value = 100;
            } else if (type === 'strong') {
                document.getElementById('wind_speed').value = 20.0;
                document.getElementById('wind_direction').value = 45;
                document.getElementById('latitude').value = 45;
                document.getElementById('depth').value = 150;
            } else if (type === 'typhoon') {
                document.getElementById('wind_speed').value = 30.0;
                document.getElementById('wind_direction').value = 90;
                document.getElementById('latitude').value = 25;
                document.getElementById('depth').value = 200;
            }
            updateSliderValues();
        }
        
        // ì§€ì—­ ì„ íƒ
        function onLocationSelect() {
            const selected = document.getElementById('location').value;
            if (selected !== 'custom' && LOCATIONS[selected]) {
                const loc = LOCATIONS[selected];
                document.getElementById('latitude').value = loc.lat;
                document.getElementById('wind_speed').value = loc.wind;
                document.getElementById('wind_direction').value = loc.wind_dir;
                updateSliderValues();
            }
        }
        
        // ì½”ë¦¬ì˜¬ë¦¬ ë§¤ê°œë³€ìˆ˜ ê³„ì‚°
        function calculateCoriolisParameter(latitude) {
            return 2 * OMEGA * Math.sin(latitude * Math.PI / 180);
        }
        
        // ì—í¬ë§Œ ìˆ˜ì†¡ ê³„ì‚°
        function calculateEkmanTransport(windSpeed, windDirection, latitude, depth) {
            if (latitude === 0) latitude = 1e-6; // 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€
            
            const f = calculateCoriolisParameter(latitude);
            const windStress = RHO_AIR * CD * windSpeed * windSpeed;
            const windDirRad = windDirection * Math.PI / 180;
            
            const tauX = windStress * Math.cos(windDirRad);
            const tauY = windStress * Math.sin(windDirRad);
            
            const Mx = -tauY / (RHO_WATER * f);
            const My = tauX / (RHO_WATER * f);
            
            const K = 0.01; // ìˆ˜ì§ ë‚œë¥˜ ì ì„± ê³„ìˆ˜
            const ekmanDepth = Math.PI * Math.sqrt(2 * K / Math.abs(f));
            
            // ì—í¬ë§Œ ë‚˜ì„  ê³„ì‚°
            const zLevels = [];
            const uVel = [];
            const vVel = [];
            
            for (let i = 0; i < 50; i++) {
                const z = (depth / 49) * i;
                zLevels.push(z);
                
                const a = Math.sqrt(Math.abs(f) / (2 * K));
                const factor = Math.exp(-a * z) / (RHO_WATER * Math.sqrt(2 * K * Math.abs(f)));
                const cosAz = Math.cos(a * z);
                const sinAz = Math.sin(a * z);
                const sgnF = Math.sign(f);
                
                const u = factor * (tauX * cosAz - sgnF * tauY * sinAz);
                const v = factor * (sgnF * tauX * sinAz + tauY * cosAz);
                
                uVel.push(u);
                vVel.push(v);
            }
            
            const energyTransfer = tauX * uVel[0] + tauY * vVel[0];
            
            return {
                windSpeed, windDirection, latitude, depth,
                windStress, tauX, tauY, Mx, My, ekmanDepth,
                zLevels, uVel, vVel, f, energyTransfer
            };
        }
        
        // í…Œë§ˆ ê°ì§€ í•¨ìˆ˜
        function isDarkMode() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        
        // í…Œë§ˆì— ë”°ë¥¸ ìƒ‰ìƒ ë°˜í™˜
        function getThemeColors() {
            const dark = isDarkMode();
            return {
                background: dark ? '#2b2b2b' : 'white',
                paper: dark ? '#1e1e1e' : 'white',
                text: dark ? '#ffffff' : '#000000',
                grid: dark ? '#404040' : 'lightgray',
                font: dark ? '#e0e0e0' : '#333333'
            };
        }
        
        // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ê°ì§€
        function isMobile() {
            return window.innerWidth <= 767;
        }
        
        // íƒœë¸”ë¦¿ ë””ë°”ì´ìŠ¤ ê°ì§€
        function isTablet() {
            return window.innerWidth > 767 && window.innerWidth <= 1024;
        }
        
        // í–¥ìƒëœ ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        function toggleMobileMenu() {
            const menuPanel = document.querySelector('.mobile-menu-panel');
            const overlay = document.querySelector('.mobile-menu-overlay');
            const toggleButton = document.querySelector('.mobile-menu-toggle');
            const body = document.body;
            
            const isActive = menuPanel.classList.contains('active');
            
            if (!isActive) {
                // ë©”ë‰´ ì—´ê¸°
                menuPanel.classList.add('active');
                overlay.classList.add('active');
                toggleButton.classList.add('active');
                body.classList.add('menu-open');
                toggleButton.setAttribute('aria-expanded', 'true');
                
                // í–„ë²„ê±° ë©”ë‰´ ì§„ë™ í”¼ë“œë°± (ì§€ì›í•˜ëŠ” ë””ë°”ì´ìŠ¤ì—ì„œ)
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            
            // ë©”ë‰´ê°€ ì—´ë ¸ì„ ë•Œ í¬ì»¤ìŠ¤ ì„¤ì • (ì ‘ê·¼ì„± ê°œì„ )
                setTimeout(() => {
                    const firstMenuItem = menuPanel.querySelector('.mobile-menu-item input, .mobile-menu-item select, .mobile-menu-item button');
                    if (firstMenuItem) firstMenuItem.focus();
                }, 400);
                
                console.log("ğŸ“± ëª¨ë°”ì¼ ë©”ë‰´ ì—´ë¦¼");
                
            } else {
                // ë©”ë‰´ ë‹«ê¸°
                closeMobileMenu();
            }
        }
        
        // í–¥ìƒëœ ëª¨ë°”ì¼ ë©”ë‰´ ë‹«ê¸°
        function closeMobileMenu() {
            const menuPanel = document.querySelector('.mobile-menu-panel');
            const overlay = document.querySelector('.mobile-menu-overlay');
            const toggleButton = document.querySelector('.mobile-menu-toggle');
            const body = document.body;
            
            menuPanel.classList.remove('active');
            overlay.classList.remove('active');
            toggleButton.classList.remove('active');
            body.classList.remove('menu-open');
            toggleButton.setAttribute('aria-expanded', 'false');
            
            // ë©”ë‰´ê°€ ë‹«í˜”ì„ ë•Œ í–„ë²„ê±° ë²„íŠ¼ì— í¬ì»¤ìŠ¤ (ì ‘ê·¼ì„± ê°œì„ )
            setTimeout(() => {
                toggleButton.focus();
            }, 100);
            
            console.log("ğŸ“± ëª¨ë°”ì¼ ë©”ë‰´ ë‹«í˜");
        }
        
        // í–¥ìƒëœ ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ë¡œ ë©”ë‰´ ë‹«ê¸°
        function setupSwipeGesture() {
            const menuPanel = document.querySelector('.mobile-menu-panel');
            const swipeIndicator = document.querySelector('.swipe-indicator');
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let swipeStarted = false;
            
            menuPanel.addEventListener('touchstart', function(e) {
                startX = e.touches[0].clientX;
                isDragging = true;
                swipeStarted = false;
            }, { passive: true });
            
            menuPanel.addEventListener('touchmove', function(e) {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                const diffX = currentX - startX;
                
                // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í•˜ëŠ” ê²½ìš° (ë©”ë‰´ ë‹«ê¸°)
                if (diffX < -30 && !swipeStarted) {
                    swipeStarted = true;
                    swipeIndicator.classList.add('active');
                    
                    // ì§„ë™ í”¼ë“œë°±
                    if (navigator.vibrate) {
                        navigator.vibrate(20);
                    }
                }
                
                if (swipeStarted && diffX < 0) {
                    const progress = Math.abs(diffX) / 150; // 150px ê¸°ì¤€
                    const clampedProgress = Math.min(progress, 1);
                    
                    // ë¶€ë“œëŸ¬ìš´ ë³€í˜• ì ìš©
                    const translateX = Math.max(diffX * 0.5, -200);
                    menuPanel.style.transform = `translateX(${translateX}px)`;
                    menuPanel.style.opacity = 1 - (clampedProgress * 0.3);
                    
                    // ìŠ¤ì™€ì´í”„ ì§„í–‰ë¥ ì— ë”°ë¼ ì¸ë””ì¼€ì´í„° ìƒ‰ìƒ ë³€ê²½
                    const hue = 240 - (clampedProgress * 60); // íŒŒë€ìƒ‰ì—ì„œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ
                    swipeIndicator.style.background = `linear-gradient(to bottom, transparent, hsl(${hue}, 70%, 60%), transparent)`;
                }
            }, { passive: true });
            
            menuPanel.addEventListener('touchend', function(e) {
                if (!isDragging) return;
                isDragging = false;
                swipeStarted = false;
                
                const diffX = currentX - startX;
                const swipeDistance = Math.abs(diffX);
                const swipeVelocity = swipeDistance / 300; // ê°„ë‹¨í•œ ì†ë„ ê³„ì‚°
                
                // ì¶©ë¶„íˆ ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í–ˆê±°ë‚˜ ë¹ ë¥¸ ì†ë„ë¡œ ìŠ¤ì™€ì´í”„í•œ ê²½ìš° ë©”ë‰´ ë‹«ê¸°
                if ((diffX < -100) || (diffX < -50 && swipeVelocity > 0.3)) {
                    // ì„±ê³µì ì¸ ìŠ¤ì™€ì´í”„ í”¼ë“œë°±
                    if (navigator.vibrate) {
                        navigator.vibrate([30, 50, 30]);
                    }
                    
                    closeMobileMenu();
                    console.log(`ğŸ“± ìŠ¤ì™€ì´í”„ë¡œ ë©”ë‰´ ë‹«ê¸° (ê±°ë¦¬: ${swipeDistance.toFixed(0)}px, ì†ë„: ${swipeVelocity.toFixed(2)})`);
                } else {
                    // ìŠ¤ì™€ì´í”„ ì·¨ì†Œ - ì›ë˜ ìœ„ì¹˜ë¡œ ë³µì›
                    if (navigator.vibrate) {
                        navigator.vibrate(10);
                    }
                }
                
                // ë³€í˜• ë° ì¸ë””ì¼€ì´í„° ì´ˆê¸°í™”
                menuPanel.style.transform = '';
                menuPanel.style.opacity = '';
                swipeIndicator.classList.remove('active');
                swipeIndicator.style.background = '';
                
            }, { passive: true });
            
            // ìŠ¤ì™€ì´í”„ ì·¨ì†Œ (í„°ì¹˜ê°€ ë©”ë‰´ ë°–ìœ¼ë¡œ ë‚˜ê°”ì„ ë•Œ)
            document.addEventListener('touchend', function(e) {
                if (isDragging && !menuPanel.contains(e.target)) {
                    isDragging = false;
                    swipeStarted = false;
                    menuPanel.style.transform = '';
                    menuPanel.style.opacity = '';
                    swipeIndicator.classList.remove('active');
                    swipeIndicator.style.background = '';
                }
            }, { passive: true });
        }
        
        // ëª¨ë°”ì¼ ìµœì í™” 2D ì‹œê°í™” ìƒì„± (ê°„ë‹¨í•œ ë‹¨ì¼ ì°¨íŠ¸)
        function createMobile2DPlot(results) {
            const colors = getThemeColors();
            const traces = [];
            
            // ëª¨ë°”ì¼ì—ì„œëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì •ë³´ë§Œ ê°„ë‹¨íˆ í‘œì‹œ
            // ì—í¬ë§Œ ë‚˜ì„  + ë°”ëŒ ë²¡í„°ë¥¼ í•˜ë‚˜ì˜ ì°¨íŠ¸ë¡œ
            
            // 1. ì—í¬ë§Œ ë‚˜ì„ 
            traces.push({
                x: results.uVel, 
                y: results.vVel,
                mode: 'lines+markers',
                line: {color: '#FF4081', width: 4},
                marker: {
                    size: 8,
                    color: results.zLevels,
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: {
                        title: {text: t('depth'), font: {color: colors.text, size: 14}},
                        bgcolor: colors.background,
                        bordercolor: colors.grid,
                        tickfont: {color: colors.text, size: 12},
                        len: 0.6,
                        thickness: 20,
                        x: 1.02
                    }
                },
                name: currentLanguage === 'ko' ? 'ì—í¬ë§Œ ë‚˜ì„ ' :
                      currentLanguage === 'zh' ? 'åŸƒå…‹æ›¼èºçº¿' :
                      currentLanguage === 'ja' ? 'ã‚¨ã‚¯ãƒãƒ³èºæ—‹' :
                      currentLanguage === 'es' ? 'Espiral de Ekman' :
                      currentLanguage === 'ru' ? 'Ğ¡Ğ¿Ğ¸Ñ€Ğ°Ğ»ÑŒ Ğ­ĞºĞ¼Ğ°Ğ½Ğ°' :
                      'Ekman Spiral',
                hovertemplate: `${currentLanguage === 'ko' ? 'ê¹Šì´' :
                               currentLanguage === 'zh' ? 'æ·±åº¦' :
                               currentLanguage === 'ja' ? 'æ·±åº¦' :
                               currentLanguage === 'es' ? 'Profundidad' :
                               currentLanguage === 'ru' ? 'Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°' :
                               'Depth'}: %{marker.color:.1f}m<br>U: %{x:.4f}, V: %{y:.4f} m/s<extra></extra>`
            });
            
            // 2. ë°”ëŒ ë²¡í„° (ìŠ¤ì¼€ì¼ ì¡°ì •)
            const windDirRad = results.windDirection * Math.PI / 180;
            const windScale = Math.max(...results.uVel.map(Math.abs), ...results.vVel.map(Math.abs)) * 0.5;
            const windX = windScale * Math.cos(windDirRad);
            const windY = windScale * Math.sin(windDirRad);
            
            traces.push({
                x: [0, windX], 
                y: [0, windY],
                mode: 'lines+markers',
                line: {color: '#FF6B35', width: 6},
                marker: {size: 15, symbol: 'arrow', color: '#FF6B35'},
                name: `ğŸŒ¬ï¸ ${currentLanguage === 'ko' ? 'ë°”ëŒ' :
                            currentLanguage === 'zh' ? 'é£' :
                            currentLanguage === 'ja' ? 'é¢¨' :
                            currentLanguage === 'es' ? 'Viento' :
                            currentLanguage === 'ru' ? 'Ğ’ĞµÑ‚ĞµÑ€' :
                            'Wind'} ${results.windSpeed.toFixed(1)} m/s`,
                hovertemplate: `${currentLanguage === 'ko' ? 'ë°”ëŒì†ë„' :
                               currentLanguage === 'zh' ? 'é£é€Ÿ' :
                               currentLanguage === 'ja' ? 'é¢¨é€Ÿ' :
                               currentLanguage === 'es' ? 'Velocidad del viento' :
                               currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ²ĞµÑ‚Ñ€Ğ°' :
                               'Wind speed'}: ${results.windSpeed.toFixed(1)} m/s<br>${currentLanguage === 'ko' ? 'ë°©í–¥' :
                                                                                    currentLanguage === 'zh' ? 'æ–¹å‘' :
                                                                                    currentLanguage === 'ja' ? 'æ–¹å‘' :
                                                                                    currentLanguage === 'es' ? 'DirecciÃ³n' :
                                                                                    currentLanguage === 'ru' ? 'ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ' :
                                                                                    'Direction'}: ${results.windDirection.toFixed(0)}Â°<extra></extra>`
            });
            
            // 3. ìˆ˜ì†¡ ë²¡í„° (ìŠ¤ì¼€ì¼ ì¡°ì •) 
            const transportScale = windScale * 0.3;
            traces.push({
                x: [0, results.Mx * transportScale / Math.abs(results.Mx || 1)], 
                y: [0, results.My * transportScale / Math.abs(results.My || 1)],
                mode: 'lines+markers',
                line: {color: '#4A9EFF', width: 5, dash: 'dash'},
                marker: {size: 12, symbol: 'arrow', color: '#4A9EFF'},
                name: `ğŸ“Š ${currentLanguage === 'ko' ? 'ìˆ˜ì†¡' :
                            currentLanguage === 'zh' ? 'è¾“è¿' :
                            currentLanguage === 'ja' ? 'è¼¸é€' :
                            currentLanguage === 'es' ? 'Transporte' :
                            currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ' :
                            'Transport'} ${Math.sqrt(results.Mx**2 + results.My**2).toExponential(1)} mÂ³/s`,
                hovertemplate: `${currentLanguage === 'ko' ? 'ìˆ˜ì†¡ëŸ‰' :
                               currentLanguage === 'zh' ? 'è¾“è¿é‡' :
                               currentLanguage === 'ja' ? 'è¼¸é€é‡' :
                               currentLanguage === 'es' ? 'Transporte' :
                               currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ' :
                               'Transport'}: ${Math.sqrt(results.Mx**2 + results.My**2).toExponential(2)} mÂ³/s<extra></extra>`
            });
            
            const layout = {
                title: {
                    text: t('chart_title_mobile') + `<br>${currentLanguage === 'ko' ? 'ìœ„ë„' :
                                                           currentLanguage === 'zh' ? 'çº¬åº¦' :
                                                           currentLanguage === 'ja' ? 'ç·¯åº¦' :
                                                           currentLanguage === 'es' ? 'Latitud' :
                                                           currentLanguage === 'ru' ? 'Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ°' :
                                                           'Latitude'}: ${results.latitude.toFixed(1)}Â°`,
                    font: {color: colors.text, size: 16},
                    x: 0.5,
                    y: 0.95
                },
                xaxis: {
                    title: {text: `U ${currentLanguage === 'ko' ? 'ì†ë„ (ë™-ì„œ, m/s)' :
                                   currentLanguage === 'zh' ? 'é€Ÿåº¦ (ä¸œ-è¥¿, m/s)' :
                                   currentLanguage === 'ja' ? 'é€Ÿåº¦ (æ±-è¥¿, m/s)' :
                                   currentLanguage === 'es' ? 'Velocidad (Este-Oeste, m/s)' :
                                   currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ’Ğ¾ÑÑ‚Ğ¾Ğº-Ğ—Ğ°Ğ¿Ğ°Ğ´, Ğ¼/Ñ)' :
                                   'Velocity (East-West, m/s)'}`, font: {color: colors.text, size: 12}},
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text, size: 11},
                    linecolor: colors.grid,
                    zeroline: true,
                    zerolinecolor: colors.grid
                },
                yaxis: {
                    title: {text: `V ${currentLanguage === 'ko' ? 'ì†ë„ (ë‚¨-ë¶, m/s)' :
                                   currentLanguage === 'zh' ? 'é€Ÿåº¦ (å—-åŒ—, m/s)' :
                                   currentLanguage === 'ja' ? 'é€Ÿåº¦ (å—-åŒ—, m/s)' :
                                   currentLanguage === 'es' ? 'Velocidad (Sur-Norte, m/s)' :
                                   currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ®Ğ³-Ğ¡ĞµĞ²ĞµÑ€, Ğ¼/Ñ)' :
                                   'Velocity (South-North, m/s)'}`, font: {color: colors.text, size: 12}},
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text, size: 11},
                    linecolor: colors.grid,
                    zeroline: true,
                    zerolinecolor: colors.grid
                },
                height: 600,
                showlegend: true,
                legend: {
                    font: {color: colors.text, size: 11},
                    bgcolor: 'rgba(0,0,0,0)',
                    x: 0.02,
                    y: 0.98
                },
                font: {size: 11, color: colors.text},
                plot_bgcolor: colors.background,
                paper_bgcolor: colors.paper,
                margin: {l: 60, r: 80, t: 80, b: 60}
            };
            
            return {data: traces, layout: layout};
        }
        
        // 2D ì‹œê°í™” ìƒì„±
        function create2DPlot(results) {
            const traces = [];
            const colors = getThemeColors();
            
            // 1. ë°”ëŒ vs ìˆ˜ì†¡ ë²¡í„°
            const windDirRad = results.windDirection * Math.PI / 180;
            const windX = results.windSpeed * Math.cos(windDirRad);
            const windY = results.windSpeed * Math.sin(windDirRad);
            
            traces.push({
                x: [0, windX], y: [0, windY],
                mode: 'lines+markers',
                line: {color: '#FF6B35', width: 4},
                marker: {size: 10},
                name: `${currentLanguage === 'ko' ? 'ë°”ëŒ' :
                        currentLanguage === 'zh' ? 'é£' :
                        currentLanguage === 'ja' ? 'é¢¨' :
                        currentLanguage === 'es' ? 'Viento' :
                        currentLanguage === 'ru' ? 'Ğ’ĞµÑ‚ĞµÑ€' :
                        'Wind'} ${results.windSpeed.toFixed(1)} m/s`,
                xaxis: 'x', yaxis: 'y'
            });
            
            const transportScale = 1e6;
            traces.push({
                x: [0, results.Mx * transportScale], 
                y: [0, results.My * transportScale],
                mode: 'lines+markers',
                line: {color: '#4A9EFF', width: 4},
                marker: {size: 10},
                name: `${currentLanguage === 'ko' ? 'ìˆ˜ì†¡' :
                        currentLanguage === 'zh' ? 'è¾“è¿' :
                        currentLanguage === 'ja' ? 'è¼¸é€' :
                        currentLanguage === 'es' ? 'Transporte' :
                        currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ' :
                        'Transport'} ${Math.sqrt(results.Mx**2 + results.My**2).toExponential(2)} mÂ³/s`,
                xaxis: 'x', yaxis: 'y'
            });
            
            // 2. ì—í¬ë§Œ ë‚˜ì„ 
            traces.push({
                x: results.uVel, y: results.vVel,
                mode: 'lines+markers',
                line: {color: '#FF4081', width: 3},
                marker: {
                    size: 6,
                    color: results.zLevels,
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: {
                        title: {text: t('depth'), font: {color: colors.text}}, 
                        x: 0.48, y: 0.75, len: 0.25,
                        bgcolor: colors.background,
                        bordercolor: colors.grid,
                        tickfont: {color: colors.text}
                    }
                },
                name: currentLanguage === 'ko' ? 'ì—í¬ë§Œ ë‚˜ì„ ' :
                      currentLanguage === 'zh' ? 'åŸƒå…‹æ›¼èºçº¿' :
                      currentLanguage === 'ja' ? 'ã‚¨ã‚¯ãƒãƒ³èºæ—‹' :
                      currentLanguage === 'es' ? 'Espiral de Ekman' :
                      currentLanguage === 'ru' ? 'Ğ¡Ğ¿Ğ¸Ñ€Ğ°Ğ»ÑŒ Ğ­ĞºĞ¼Ğ°Ğ½Ğ°' :
                      'Ekman Spiral',
                xaxis: 'x2', yaxis: 'y2'
            });
            
            // 3. ê¹Šì´ë³„ ì†ë„ í”„ë¡œíŒŒì¼
            traces.push({
                x: results.uVel, y: results.zLevels.map(z => -z),
                mode: 'lines+markers',
                line: {color: '#1F77B4', width: 3},
                marker: {size: 4},
                name: `U ${currentLanguage === 'ko' ? 'ì†ë„ (ë™-ì„œ)' :
                           currentLanguage === 'zh' ? 'é€Ÿåº¦ (ä¸œ-è¥¿)' :
                           currentLanguage === 'ja' ? 'é€Ÿåº¦ (æ±-è¥¿)' :
                           currentLanguage === 'es' ? 'Velocidad (Este-Oeste)' :
                           currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ’Ğ¾ÑÑ‚Ğ¾Ğº-Ğ—Ğ°Ğ¿Ğ°Ğ´)' :
                           'Velocity (East-West)'}`,
                xaxis: 'x3', yaxis: 'y3'
            });
            
            traces.push({
                x: results.vVel, y: results.zLevels.map(z => -z),
                mode: 'lines+markers',
                line: {color: '#FF7F0E', width: 3},
                marker: {size: 4},
                name: `V ${currentLanguage === 'ko' ? 'ì†ë„ (ë‚¨-ë¶)' :
                           currentLanguage === 'zh' ? 'é€Ÿåº¦ (å—-åŒ—)' :
                           currentLanguage === 'ja' ? 'é€Ÿåº¦ (å—-åŒ—)' :
                           currentLanguage === 'es' ? 'Velocidad (Sur-Norte)' :
                           currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ®Ğ³-Ğ¡ĞµĞ²ĞµÑ€)' :
                           'Velocity (South-North)'}`,
                xaxis: 'x3', yaxis: 'y3'
            });
            
            // 4. ìˆ˜ì†¡ ì„±ë¶„ ë°” ì°¨íŠ¸
            traces.push({
                x: [`Mx (${currentLanguage === 'ko' ? 'ë™-ì„œ' :
                           currentLanguage === 'zh' ? 'ä¸œ-è¥¿' :
                           currentLanguage === 'ja' ? 'æ±-è¥¿' :
                           currentLanguage === 'es' ? 'Este-Oeste' :
                           currentLanguage === 'ru' ? 'Ğ’Ğ¾ÑÑ‚Ğ¾Ğº-Ğ—Ğ°Ğ¿Ğ°Ğ´' :
                           'East-West'})`, 
                    `My (${currentLanguage === 'ko' ? 'ë‚¨-ë¶' :
                           currentLanguage === 'zh' ? 'å—-åŒ—' :
                           currentLanguage === 'ja' ? 'å—-åŒ—' :
                           currentLanguage === 'es' ? 'Sur-Norte' :
                           currentLanguage === 'ru' ? 'Ğ®Ğ³-Ğ¡ĞµĞ²ĞµÑ€' :
                           'South-North'})`],
                y: [results.Mx, results.My],
                type: 'bar',
                marker: {color: ['#1F77B4', '#FF7F0E']},
                name: currentLanguage === 'ko' ? 'ìˆ˜ì†¡ ì„±ë¶„' :
                      currentLanguage === 'zh' ? 'è¾“è¿åˆ†é‡' :
                      currentLanguage === 'ja' ? 'è¼¸é€æˆåˆ†' :
                      currentLanguage === 'es' ? 'Componentes de Transporte' :
                      currentLanguage === 'ru' ? 'ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¿ĞµÑ€ĞµĞ½Ğ¾ÑĞ°' :
                      'Transport Components',
                xaxis: 'x4', yaxis: 'y4'
            });
            
            const layout = {
                title: {
                    text: t('chart_title_2d') + ` (${currentLanguage === 'ko' ? 'ìœ„ë„' :
                                                     currentLanguage === 'zh' ? 'çº¬åº¦' :
                                                     currentLanguage === 'ja' ? 'ç·¯åº¦' :
                                                     currentLanguage === 'es' ? 'Latitud' :
                                                     currentLanguage === 'ru' ? 'Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ°' :
                                                     'Latitude'}: ${results.latitude.toFixed(1)}Â°)`,
                    font: {color: colors.text, size: 16}
                },
                grid: {rows: 2, columns: 2, pattern: 'independent'},
                
                // ëª¨ë“  ì¶• ìŠ¤íƒ€ì¼ë§
                xaxis: {
                    title: {text: currentLanguage === 'ko' ? 'ë™-ì„œ ë°©í–¥ (m/s)' :
                                  currentLanguage === 'zh' ? 'ä¸œ-è¥¿æ–¹å‘ (m/s)' :
                                  currentLanguage === 'ja' ? 'æ±-è¥¿æ–¹å‘ (m/s)' :
                                  currentLanguage === 'es' ? 'DirecciÃ³n Este-Oeste (m/s)' :
                                  currentLanguage === 'ru' ? 'ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ’Ğ¾ÑÑ‚Ğ¾Ğº-Ğ—Ğ°Ğ¿Ğ°Ğ´ (Ğ¼/Ñ)' :
                                  'East-West Direction (m/s)', font: {color: colors.text}}, 
                    domain: [0, 0.45],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                yaxis: {
                    title: {text: currentLanguage === 'ko' ? 'ë‚¨-ë¶ ë°©í–¥ (m/s)' :
                                  currentLanguage === 'zh' ? 'å—-åŒ—æ–¹å‘ (m/s)' :
                                  currentLanguage === 'ja' ? 'å—-åŒ—æ–¹å‘ (m/s)' :
                                  currentLanguage === 'es' ? 'DirecciÃ³n Sur-Norte (m/s)' :
                                  currentLanguage === 'ru' ? 'ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ®Ğ³-Ğ¡ĞµĞ²ĞµÑ€ (Ğ¼/Ñ)' :
                                  'South-North Direction (m/s)', font: {color: colors.text}}, 
                    domain: [0.55, 1],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                xaxis2: {
                    title: {text: `U ${currentLanguage === 'ko' ? 'ì†ë„ (m/s)' :
                                    currentLanguage === 'zh' ? 'é€Ÿåº¦ (m/s)' :
                                    currentLanguage === 'ja' ? 'é€Ÿåº¦ (m/s)' :
                                    currentLanguage === 'es' ? 'Velocidad (m/s)' :
                                    currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ¼/Ñ)' :
                                    'Velocity (m/s)'}`, font: {color: colors.text}}, 
                    domain: [0.55, 1],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                yaxis2: {
                    title: {text: `V ${currentLanguage === 'ko' ? 'ì†ë„ (m/s)' :
                                    currentLanguage === 'zh' ? 'é€Ÿåº¦ (m/s)' :
                                    currentLanguage === 'ja' ? 'é€Ÿåº¦ (m/s)' :
                                    currentLanguage === 'es' ? 'Velocidad (m/s)' :
                                    currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ¼/Ñ)' :
                                    'Velocity (m/s)'}`, font: {color: colors.text}}, 
                    domain: [0.55, 1],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                xaxis3: {
                    title: {text: currentLanguage === 'ko' ? 'ì†ë„ (m/s)' :
                                  currentLanguage === 'zh' ? 'é€Ÿåº¦ (m/s)' :
                                  currentLanguage === 'ja' ? 'é€Ÿåº¦ (m/s)' :
                                  currentLanguage === 'es' ? 'Velocidad (m/s)' :
                                  currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ¼/Ñ)' :
                                  'Velocity (m/s)', font: {color: colors.text}}, 
                    domain: [0, 0.45],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                yaxis3: {
                    title: {text: t('depth'), font: {color: colors.text}}, 
                    domain: [0, 0.45],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                xaxis4: {
                    title: {text: currentLanguage === 'ko' ? 'ì„±ë¶„' :
                                  currentLanguage === 'zh' ? 'åˆ†é‡' :
                                  currentLanguage === 'ja' ? 'æˆåˆ†' :
                                  currentLanguage === 'es' ? 'Componente' :
                                  currentLanguage === 'ru' ? 'ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚' :
                                  'Component', font: {color: colors.text}}, 
                    domain: [0.55, 1],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                yaxis4: {
                    title: {text: currentLanguage === 'ko' ? 'ìˆ˜ì†¡ëŸ‰ (mÂ³/s)' :
                                  currentLanguage === 'zh' ? 'è¾“è¿é‡ (mÂ³/s)' :
                                  currentLanguage === 'ja' ? 'è¼¸é€é‡ (mÂ³/s)' :
                                  currentLanguage === 'es' ? 'Transporte (mÂ³/s)' :
                                  currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ (Ğ¼Â³/Ñ)' :
                                  'Transport (mÂ³/s)', font: {color: colors.text}}, 
                    domain: [0, 0.45],
                    gridcolor: colors.grid,
                    tickfont: {color: colors.text},
                    linecolor: colors.grid
                },
                
                height: 800,
                showlegend: true,
                font: {size: 12, color: colors.text},
                plot_bgcolor: colors.background,
                paper_bgcolor: colors.paper,
                legend: {
                    font: {color: colors.text},
                    bgcolor: 'rgba(0,0,0,0)'
                }
            };
            
            return {data: traces, layout: layout};
        }
        
        // 3D ì‹œê°í™” ìƒì„±
        function create3DPlot(results) {
            const traces = [];
            const colors = getThemeColors();
            const speeds = results.uVel.map((u, i) => Math.sqrt(u*u + results.vVel[i]*results.vVel[i]));
            
            // ì—í¬ë§Œ ë‚˜ì„  3D
            traces.push({
                x: results.uVel,
                y: results.vVel,
                z: results.zLevels.map(z => -z),
                mode: 'lines+markers',
                type: 'scatter3d',
                line: {
                    color: speeds,
                    colorscale: 'Viridis',
                    width: 8,
                    colorbar: {
                        title: {
                            text: t('wind_speed').includes('ì†ë„') ? "ì†ë„ í¬ê¸° (m/s)" : 
                                  t('wind_speed').includes('é€Ÿåº¦') ? "æµé€Ÿ (m/s)" :
                                  t('wind_speed').includes('Wind') ? "Current Speed (m/s)" :
                                  t('wind_speed').includes('Velocidad') ? "Velocidad de Corriente (m/s)" :
                                  t('wind_speed').includes('Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ') ? "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ñ (Ğ¼/Ñ)" :
                                  "æµé€Ÿ (m/s)", 
                            font: {color: colors.text, size: 16},
                            side: 'right'
                        },
                        bgcolor: colors.background,
                        bordercolor: colors.grid,
                        borderwidth: 2,
                        tickfont: {color: colors.text, size: 14},
                        len: 0.8,
                        thickness: 25,
                        x: 1.02,
                        xanchor: 'left',
                        y: 0.5,
                        yanchor: 'middle'
                    }
                },
                marker: {size: 4, color: speeds, colorscale: 'Viridis'},
                name: currentLanguage === 'ko' ? 'ì—í¬ë§Œ ë‚˜ì„ ' :
                      currentLanguage === 'zh' ? 'åŸƒå…‹æ›¼èºçº¿' :
                      currentLanguage === 'ja' ? 'ã‚¨ã‚¯ãƒãƒ³èºæ—‹' :
                      currentLanguage === 'es' ? 'Espiral de Ekman' :
                      currentLanguage === 'ru' ? 'Ğ¡Ğ¿Ğ¸Ñ€Ğ°Ğ»ÑŒ Ğ­ĞºĞ¼Ğ°Ğ½Ğ°' :
                      'Ekman Spiral'
            });
            
            // ë°”ëŒ ë²¡í„°
            const windDirRad = results.windDirection * Math.PI / 180;
            const windX = results.windSpeed * Math.cos(windDirRad) * 0.01;
            const windY = results.windSpeed * Math.sin(windDirRad) * 0.01;
            
            traces.push({
                x: [0, windX], y: [0, windY], z: [10, 10],
                mode: 'lines+markers',
                type: 'scatter3d',
                line: {color: '#FF6B35', width: 10},
                marker: {size: 8, color: '#FF6B35'},
                name: `ğŸŒ¬ï¸ ${currentLanguage === 'ko' ? 'ë°”ëŒ' :
                            currentLanguage === 'zh' ? 'é£' :
                            currentLanguage === 'ja' ? 'é¢¨' :
                            currentLanguage === 'es' ? 'Viento' :
                            currentLanguage === 'ru' ? 'Ğ’ĞµÑ‚ĞµÑ€' :
                            'Wind'} ${results.windSpeed.toFixed(1)} m/s`
            });
            
            // ì—í¬ë§Œ ê¹Šì´ë³„ ë²¡í„° í•„ë“œ í‘œì‹œ
            const step = Math.max(1, Math.floor(results.zLevels.length / 8));
            for (let i = 0; i < results.zLevels.length; i += step) {
                const scale = 0.02;
                const alpha = 0.6;
                traces.push({
                    x: [0, results.uVel[i] * scale],
                    y: [0, results.vVel[i] * scale],
                    z: [-results.zLevels[i], -results.zLevels[i]],
                    mode: 'lines',
                    type: 'scatter3d',
                    line: {
                        color: `rgba(${isDarkMode() ? '100, 149, 237' : '30, 144, 255'}, ${alpha})`,
                        width: 4
                    },
                    showlegend: false,
                    hovertemplate: `${currentLanguage === 'ko' ? 'ê¹Šì´' :
                                   currentLanguage === 'zh' ? 'æ·±åº¦' :
                                   currentLanguage === 'ja' ? 'æ·±åº¦' :
                                   currentLanguage === 'es' ? 'Profundidad' :
                                   currentLanguage === 'ru' ? 'Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°' :
                                   'Depth'}: ${results.zLevels[i].toFixed(1)}m<br>${currentLanguage === 'ko' ? 'ì†ë„' :
                                                                                currentLanguage === 'zh' ? 'é€Ÿåº¦' :
                                                                                currentLanguage === 'ja' ? 'é€Ÿåº¦' :
                                                                                currentLanguage === 'es' ? 'Velocidad' :
                                                                                currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ' :
                                                                                'Speed'}: ${speeds[i].toFixed(4)} m/s<extra></extra>`
                });
            }
            
            const layout = {
                title: {
                    text: t('chart_title_3d') + `<br>${currentLanguage === 'ko' ? 'ìœ„ë„' :
                                                  currentLanguage === 'zh' ? 'çº¬åº¦' :
                                                  currentLanguage === 'ja' ? 'ç·¯åº¦' :
                                                  currentLanguage === 'es' ? 'Latitud' :
                                                  currentLanguage === 'ru' ? 'Ğ¨Ğ¸Ñ€Ğ¾Ñ‚Ğ°' :
                                                  'Latitude'}: ${results.latitude.toFixed(1)}Â°`,
                    font: {color: colors.text, size: 18},
                    x: 0.5,
                    y: 0.95
                },
                scene: {
                    bgcolor: colors.background,
                    xaxis: {
                        title: {text: `U ${currentLanguage === 'ko' ? 'ì†ë„ (ë™-ì„œ, m/s)' :
                                      currentLanguage === 'zh' ? 'é€Ÿåº¦ (ä¸œ-è¥¿, m/s)' :
                                      currentLanguage === 'ja' ? 'é€Ÿåº¦ (æ±-è¥¿, m/s)' :
                                      currentLanguage === 'es' ? 'Velocidad (Este-Oeste, m/s)' :
                                      currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ’Ğ¾ÑÑ‚Ğ¾Ğº-Ğ—Ğ°Ğ¿Ğ°Ğ´, Ğ¼/Ñ)' :
                                      'Velocity (East-West, m/s)'}`, font: {color: colors.text, size: 14}},
                        gridcolor: colors.grid,
                        tickfont: {color: colors.text, size: 12},
                        linecolor: colors.grid,
                        backgroundcolor: colors.background
                    },
                    yaxis: {
                        title: {text: `V ${currentLanguage === 'ko' ? 'ì†ë„ (ë‚¨-ë¶, m/s)' :
                                      currentLanguage === 'zh' ? 'é€Ÿåº¦ (å—-åŒ—, m/s)' :
                                      currentLanguage === 'ja' ? 'é€Ÿåº¦ (å—-åŒ—, m/s)' :
                                      currentLanguage === 'es' ? 'Velocidad (Sur-Norte, m/s)' :
                                      currentLanguage === 'ru' ? 'Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ (Ğ®Ğ³-Ğ¡ĞµĞ²ĞµÑ€, Ğ¼/Ñ)' :
                                      'Velocity (South-North, m/s)'}`, font: {color: colors.text, size: 14}},
                        gridcolor: colors.grid,
                        tickfont: {color: colors.text, size: 12},
                        linecolor: colors.grid,
                        backgroundcolor: colors.background
                    },
                    zaxis: {
                        title: {text: t('depth'), font: {color: colors.text, size: 14}},
                        gridcolor: colors.grid,
                        tickfont: {color: colors.text, size: 12},
                        linecolor: colors.grid,
                        backgroundcolor: colors.background
                    },
                    camera: {
                        eye: {x: 1.8, y: 1.8, z: 1.5}
                    },
                    aspectmode: 'cube'
                },
                autosize: true,
                width: null,
                height: null,
                margin: {l: 0, r: 0, t: 60, b: 0},
                font: {size: 14, color: colors.text},
                plot_bgcolor: colors.background,
                paper_bgcolor: colors.paper,
                legend: {
                    font: {color: colors.text, size: 12},
                    bgcolor: 'rgba(0,0,0,0)',
                    x: 0.02,
                    y: 0.98
                }
            };
            
            return {data: traces, layout: layout};
        }
        
        // ë©”ì¸ ê³„ì‚° ë° ì‹œê°í™” í•¨ìˆ˜
        function calculateAndVisualize() {
            try {
                console.log("ğŸ”„ ê³„ì‚° ì‹œì‘...");
                
                const windSpeed = parseFloat(document.getElementById('wind_speed').value);
                const windDirection = parseFloat(document.getElementById('wind_direction').value);
                let latitude = parseFloat(document.getElementById('latitude').value);
                const depth = parseFloat(document.getElementById('depth').value);
                
                if (latitude === 0) {
                    latitude = 1;
                    document.getElementById('latitude').value = 1;
                    updateSliderValues();
                }
                
                const results = calculateEkmanTransport(windSpeed, windDirection, latitude, depth);
                currentResults = results;
                
                const visType = document.querySelector('input[name="vis_type"]:checked').value;
                
                let plotData;
                let config;
                
                if (isMobile()) {
                    // ëª¨ë°”ì¼ ìµœì í™”
                    if (visType === '3d') {
                        plotData = create3DPlot(results);
                    } else {
                        plotData = createMobile2DPlot(results);
                    }
                    
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        scrollZoom: true,
                        modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                        modeBarButtonsToAdd: ['downloadpng'],
                        toImageButtonOptions: {
                            format: 'png',
                            filename: 'ekman_transport_mobile',
                            height: 800,
                            width: 600,
                            scale: 2
                        },
                        // ëª¨ë°”ì¼ í„°ì¹˜ ìµœì í™”
                        doubleClick: 'reset',
                        touchAction: 'auto'
                    };
                    
                    // ëª¨ë°”ì¼ì—ì„œ ê³„ì‚° í›„ ë©”ë‰´ ìë™ ë‹«ê¸° (ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜)
                    setTimeout(() => {
                        closeMobileMenu();
                        
                        // ì„±ê³µ í”¼ë“œë°±
                        if (navigator.vibrate) {
                            navigator.vibrate([100, 50, 100]);
                        }
                        
                        console.log("ğŸ“± ê³„ì‚° ì™„ë£Œ - ë©”ë‰´ ìë™ ë‹«ê¸°");
                    }, 800);
                    
                } else if (isTablet()) {
                    // íƒœë¸”ë¦¿ ìµœì í™”
                    if (visType === '3d') {
                        plotData = create3DPlot(results);
                    } else {
                        plotData = create2DPlot(results);
                    }
                    
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        modeBarButtonsToAdd: ['downloadpng'],
                        toImageButtonOptions: {
                            format: 'png',
                            filename: 'ekman_transport_tablet',
                            height: 900,
                            width: 1200,
                            scale: 2
                        }
                    };
                    
                } else {
                    // ë°ìŠ¤í¬í†± (ê¸°ì¡´)
                    if (visType === '3d') {
                        plotData = create3DPlot(results);
                    } else {
                        plotData = create2DPlot(results);
                    }
                    
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        modeBarButtonsToAdd: ['downloadpng'],
                        toImageButtonOptions: {
                            format: 'png',
                            filename: 'ekman_transport_plot',
                            height: 1000,
                            width: 1600,
                            scale: 2
                        }
                    };
                }
                
                document.getElementById('plot-area').innerHTML = '';
                Plotly.newPlot('plot-area', plotData.data, plotData.layout, config);
                
                // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë° ë ˆì´ì•„ì›ƒ ì¬êµ¬ì„±
                window.addEventListener('resize', function() {
                    Plotly.Plots.resize('plot-area');
                    handleWindowResize();
                });
                
                updateResultsDisplay(results);
                
                console.log("âœ… ê³„ì‚° ë° ì‹œê°í™” ì™„ë£Œ!");
                
            } catch (error) {
                console.error("âŒ ì˜¤ë¥˜ ë°œìƒ:", error);
                document.getElementById('plot-area').innerHTML = 
                    `<div style="color: red; text-align: center; padding: 50px; font-size: 16px;">
                        ì˜¤ë¥˜: ${error.message}<br>íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
                    </div>`;
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateResultsDisplay(results) {
            document.getElementById('wind_stress').textContent = 
                `${(results.windStress * 1000).toFixed(3)} mN/mÂ²`;
            document.getElementById('ekman_depth').textContent = 
                `${results.ekmanDepth.toFixed(2)} m`;
            
            const totalTransport = Math.sqrt(results.Mx**2 + results.My**2);
            document.getElementById('total_transport').textContent = 
                `${totalTransport.toExponential(3)} mÂ³/s`;
            document.getElementById('energy_transfer').textContent = 
                `${(results.energyTransfer * 1000).toFixed(4)} mW/mÂ²`;
            
            // ê²°ê³¼ í‘œì‹œ í›„ ë¼ë²¨ë“¤ì„ í˜„ì¬ ì–¸ì–´ë¡œ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                const resultLabels = document.querySelectorAll('.result-label');
                resultLabels.forEach((element) => {
                    const currentText = element.textContent.trim();
                    
                    // ë°”ëŒ ì‘ë ¥
                    if (currentText.includes('ë°”ëŒ') || currentText.includes('Wind') || currentText.includes('é£') || 
                        currentText.includes('é¢¨') || currentText.includes('Viento') || currentText.includes('Ğ’ĞµÑ‚Ñ€Ğ°') || currentText.includes('ĞĞ°Ğ¿Ñ€ÑĞ¶ĞµĞ½Ğ¸Ğµ')) {
                        element.textContent = t('wind_stress');
                    }
                    // ì—í¬ë§Œ ê¹Šì´
                    else if (currentText.includes('ì—í¬ë§Œ') || currentText.includes('Ekman') || currentText.includes('åŸƒå…‹æ›¼') || 
                             currentText.includes('ã‚¨ã‚¯ãƒãƒ³') || currentText.includes('Ğ­ĞºĞ¼Ğ°Ğ½Ğ°') || currentText.includes('Ğ“Ğ»ÑƒĞ±Ğ¸Ğ½Ğ°')) {
                        element.textContent = t('ekman_depth');
                    }
                    // ì´ ìˆ˜ì†¡ëŸ‰
                    else if (currentText.includes('ìˆ˜ì†¡') || currentText.includes('Transport') || currentText.includes('è¾“è¿') || 
                             currentText.includes('è¼¸é€') || currentText.includes('Transporte') || currentText.includes('ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ')) {
                        element.textContent = t('total_transport');
                    }
                    // ì—ë„ˆì§€ ì „ë‹¬ë¥ 
                    else if (currentText.includes('ì—ë„ˆì§€') || currentText.includes('Energy') || currentText.includes('èƒ½é‡') || 
                             currentText.includes('ã‚¨ãƒãƒ«ã‚®ãƒ¼') || currentText.includes('EnergÃ­a') || currentText.includes('Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ğ¸') || currentText.includes('ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ°')) {
                        element.textContent = t('energy_transfer');
                    }
                });
                
                console.log(`ğŸŒ ê²°ê³¼ ë¼ë²¨ì´ ${currentLanguage} ì–¸ì–´ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }, 10);
        }
        
        // ë‚´ë³´ë‚´ê¸°
        function exportResults() {
            if (!currentResults) {
                const message = currentLanguage === 'ko' ? "âŒ ë¨¼ì € ê³„ì‚°ì„ ìˆ˜í–‰í•˜ì„¸ìš”." :
                               currentLanguage === 'zh' ? "âŒ è¯·å…ˆæ‰§è¡Œè®¡ç®—ã€‚" :
                               currentLanguage === 'ja' ? "âŒ ã¾ãšè¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚" :
                               currentLanguage === 'es' ? "âŒ Por favor, ejecute el cÃ¡lculo primero." :
                               currentLanguage === 'ru' ? "âŒ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ°ÑÑ‡ĞµÑ‚." :
                               "âŒ Please run the calculation first.";
                console.log(message);
                return;
            }
            
            const exportData = {
                [currentLanguage === 'ko' ? 'ì…ë ¥ íŒŒë¼ë¯¸í„°' :
                 currentLanguage === 'zh' ? 'è¾“å…¥å‚æ•°' :
                 currentLanguage === 'ja' ? 'å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿' :
                 currentLanguage === 'es' ? 'ParÃ¡metros de Entrada' :
                 currentLanguage === 'ru' ? 'Ğ’Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹' :
                 'Input Parameters']: {
                    [t('wind_speed')]: currentResults.windSpeed,
                    [t('wind_direction')]: currentResults.windDirection,
                    [t('latitude')]: currentResults.latitude,
                    [t('depth')]: currentResults.depth
                },
                [currentLanguage === 'ko' ? 'ê³„ì‚° ê²°ê³¼' :
                 currentLanguage === 'zh' ? 'è®¡ç®—ç»“æœ' :
                 currentLanguage === 'ja' ? 'è¨ˆç®—çµæœ' :
                 currentLanguage === 'es' ? 'Resultados del CÃ¡lculo' :
                 currentLanguage === 'ru' ? 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°' :
                 'Calculation Results']: {
                    [t('wind_stress')]: currentResults.windStress.toExponential(6),
                    [t('ekman_depth')]: currentResults.ekmanDepth.toFixed(2),
                    [`Mx ${currentLanguage === 'ko' ? 'ìˆ˜ì†¡' :
                           currentLanguage === 'zh' ? 'è¾“è¿' :
                           currentLanguage === 'ja' ? 'è¼¸é€' :
                           currentLanguage === 'es' ? 'Transporte' :
                           currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ' :
                           'Transport'} (mÂ³/s)`]: currentResults.Mx.toExponential(6),
                    [`My ${currentLanguage === 'ko' ? 'ìˆ˜ì†¡' :
                           currentLanguage === 'zh' ? 'è¾“è¿' :
                           currentLanguage === 'ja' ? 'è¼¸é€' :
                           currentLanguage === 'es' ? 'Transporte' :
                           currentLanguage === 'ru' ? 'ĞŸĞµÑ€ĞµĞ½Ğ¾Ñ' :
                           'Transport'} (mÂ³/s)`]: currentResults.My.toExponential(6),
                    [t('total_transport')]: Math.sqrt(currentResults.Mx**2 + currentResults.My**2).toExponential(6),
                    [t('energy_transfer')]: currentResults.energyTransfer.toExponential(6),
                    [currentLanguage === 'ko' ? 'ì½”ë¦¬ì˜¬ë¦¬ ë§¤ê°œë³€ìˆ˜' :
                     currentLanguage === 'zh' ? 'ç§‘é‡Œå¥¥åˆ©å‚æ•°' :
                     currentLanguage === 'ja' ? 'ã‚³ãƒªã‚ªãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿' :
                     currentLanguage === 'es' ? 'ParÃ¡metro de Coriolis' :
                     currentLanguage === 'ru' ? 'ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ ĞšĞ¾Ñ€Ğ¸Ğ¾Ğ»Ğ¸ÑĞ°' :
                     'Coriolis Parameter']: currentResults.f.toExponential(6)
                }
            };
            
            const message = currentLanguage === 'ko' ? "ğŸ“Š ë‚´ë³´ë‚´ê¸° ë°ì´í„°:" :
                           currentLanguage === 'zh' ? "ğŸ“Š å¯¼å‡ºæ•°æ®:" :
                           currentLanguage === 'ja' ? "ğŸ“Š ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿:" :
                           currentLanguage === 'es' ? "ğŸ“Š Datos de exportaciÃ³n:" :
                           currentLanguage === 'ru' ? "ğŸ“Š Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ°:" :
                           "ğŸ“Š Export Data:";
            
            console.log(message);
            console.log(JSON.stringify(exportData, null, 2));
        }
        
                // í…Œë§ˆ ë³€ê²½ ê°ì§€ ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ë””ë°”ì´ìŠ¤ë³„ ìµœì í™”)
        function handleThemeChange() {
            if (currentResults) {
                const visType = document.querySelector('input[name="vis_type"]:checked').value;
                let plotData;
                let config;
                
                // ë””ë°”ì´ìŠ¤ë³„ ì°¨íŠ¸ ì„ íƒ
                if (isMobile()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = createMobile2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        scrollZoom: true,
                        doubleClick: 'reset',
                        touchAction: 'auto'
                    };
                } else if (isTablet()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                } else {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                }
                
                Plotly.newPlot('plot-area', plotData.data, plotData.layout, config);
                
                // ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ ì ìš©
                setTimeout(() => {
                    Plotly.Plots.resize('plot-area');
                }, 100);
                
                console.log(`ğŸ¨ í…Œë§ˆ ë³€ê²½ - ${isMobile() ? 'ëª¨ë°”ì¼' : isTablet() ? 'íƒœë¸”ë¦¿' : 'ë°ìŠ¤í¬í†±'} ìµœì í™” ì ìš©!`);
            }
        }
        
        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ê°ì§€ ë° ì ì‘í˜• ë ˆì´ì•„ì›ƒ
        function handleWindowResize() {
            if (currentResults) {
                // ë””ë°”ì´ìŠ¤ íƒ€ì…ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì°¨íŠ¸ ì¬êµ¬ì„±
                setTimeout(() => {
                    handleThemeChange();
                }, 200);
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            // ì–¸ì–´ ì„¤ì • ì´ˆê¸°í™”
            const languageSelect = document.getElementById('language');
            languageSelect.value = currentLanguage;
            
            // ì–¸ì–´ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            languageSelect.addEventListener('change', function() {
                changeLanguage(this.value);
                console.log(`ğŸŒ ì–¸ì–´ê°€ ${this.value}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            });
            
            // ì´ˆê¸° UI í…ìŠ¤íŠ¸ ì„¤ì • (ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰)
            setTimeout(() => {
                updateUITexts();
                console.log(`ğŸŒ ì´ˆê¸° ì–¸ì–´ ì„¤ì • ì™„ë£Œ: ${currentLanguage}`);
            }, 100);
            
            // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
            ['wind_speed', 'wind_direction', 'latitude', 'depth'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateSliderValues);
            });
            
            // ì§€ì—­ ì„ íƒ ì´ë²¤íŠ¸
            document.getElementById('location').addEventListener('change', onLocationSelect);
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (ESCë¡œ ë©”ë‰´ ë‹«ê¸°, Enterë¡œ ë©”ë‰´ ì—´ê¸°)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const menuPanel = document.querySelector('.mobile-menu-panel');
                    if (menuPanel && menuPanel.classList.contains('active')) {
                        closeMobileMenu();
                        e.preventDefault();
                    }
                }
                
                // í–„ë²„ê±° ë²„íŠ¼ì— í¬ì»¤ìŠ¤ê°€ ìˆì„ ë•Œ Enter/Spaceë¡œ ë©”ë‰´ í† ê¸€
                if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('mobile-menu-toggle')) {
                    toggleMobileMenu();
                    e.preventDefault();
                }
            });
            
            // ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì„¤ì •
            if (isMobile()) {
                setupSwipeGesture();
            }
            
            // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€
            if (window.matchMedia) {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', handleThemeChange);
                
                // ì´ˆê¸° í…Œë§ˆ ìƒíƒœ ë¡œê·¸
                console.log(`ğŸ¨ í˜„ì¬ í…Œë§ˆ: ${isDarkMode() ? 'ë‹¤í¬ ëª¨ë“œ' : 'ë¼ì´íŠ¸ ëª¨ë“œ'}`);
            }
            
            // ì‹œê°í™” íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸
            document.querySelectorAll('input[name="vis_type"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (currentResults) {
                        handleThemeChange(); // ë””ë°”ì´ìŠ¤ë³„ ìµœì í™”ëœ ì°¨íŠ¸ ë Œë”ë§
                    }
                });
            });
            
            // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ (ë””ë°”ì´ìŠ¤ ë³€ê²½ ê°ì§€)
            window.addEventListener('resize', handleWindowResize);
            
            // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”
            if (isMobile()) {
                // ëª¨ë°”ì¼ì—ì„œ ë“œë˜ê·¸ ì‹œ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
                document.addEventListener('touchmove', function(e) {
                    if (e.target.closest('#plot-area')) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                console.log("ğŸ“± ëª¨ë°”ì¼ ìµœì í™” ëª¨ë“œ í™œì„±í™”");
            } else if (isTablet()) {
                console.log("ğŸ“± íƒœë¸”ë¦¿ ìµœì í™” ëª¨ë“œ í™œì„±í™”");
            } else {
                console.log("ğŸ–¥ï¸ ë°ìŠ¤í¬í†± ëª¨ë“œ í™œì„±í™”");
            }
            
            // ì´ˆê¸°ê°’ ì„¤ì •
            updateSliderValues();
            
            console.log("ğŸŒŠ Ekman Transport Visualizer ë¡œë“œ ì™„ë£Œ!");
            console.log("ğŸ“Š íŒŒì´ì¬ ìŠ¤íƒ€ì¼ ì‹œê°í™”ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.");
            console.log("ğŸŒ— ìë™ ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            console.log("ğŸ“± ë°˜ì‘í˜• ë””ìì¸ (ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿/ëª¨ë°”ì¼) ì§€ì›");
            console.log(`ğŸŒ ë‹¤ì¤‘ì–¸ì–´ ì§€ì› í™œì„±í™” (í˜„ì¬: ${currentLanguage})`);
        });
        
        // ì–¸ì–´ ê°•ì œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë””ë²„ê¹… ë° ìˆ˜ë™ ì—…ë°ì´íŠ¸ìš©)
        function forceUpdateLanguage(lang = currentLanguage) {
            currentLanguage = lang;
            localStorage.setItem('ekman_language', lang);
            
            // ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
            const languageSelect = document.getElementById('language');
            if (languageSelect) {
                languageSelect.value = lang;
            }
            
            // UI í…ìŠ¤íŠ¸ ê°•ì œ ì—…ë°ì´íŠ¸
            updateUITexts();
            
            // ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            if (currentResults) {
                const visType = document.querySelector('input[name="vis_type"]:checked').value;
                let plotData;
                let config;
                
                if (isMobile()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = createMobile2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true,
                        scrollZoom: true,
                        doubleClick: 'reset',
                        touchAction: 'auto'
                    };
                } else if (isTablet()) {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                } else {
                    if (visType === '3d') {
                        plotData = create3DPlot(currentResults);
                    } else {
                        plotData = create2DPlot(currentResults);
                    }
                    config = {
                        displayModeBar: true,
                        displaylogo: false,
                        responsive: true
                    };
                }
                
                document.getElementById('plot-area').innerHTML = '';
                Plotly.newPlot('plot-area', plotData.data, plotData.layout, config);
            }
            
            console.log(`ğŸŒ ì–¸ì–´ ê°•ì œ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${lang}`);
            console.log("ğŸ’¡ ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ forceUpdateLanguage('ru') ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì–¸ì–´ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
        window.forceUpdateLanguage = forceUpdateLanguage;
        
        // ì „ì—­ ë³€ìˆ˜
    </script>
</body>
</html> 